import{_ as s,e as o,g as r,f as n,h as t,i,j as a,r as p,o as d}from"./app-D_RZWunq.js";const u={};function h(m,e){const l=p("RouteLink");return d(),o("div",null,[e[23]||(e[23]=r("h1",{id:"内网穿透",tabindex:"-1"},[r("a",{class:"header-anchor",href:"#内网穿透"},[r("span",null,"内网穿透")])],-1)),r("ol",null,[r("li",null,[e[1]||(e[1]=t("在 ")),i(l,{to:"/articles/linux/openwrt.html"},{default:a(()=>e[0]||(e[0]=[t("iStoreOS")])),_:1}),e[2]||(e[2]=t(" 软路由上部署了应用后，我需要一个内网穿透让我在任何地点都能连上应用。需求：免费，稳定。"))]),r("li",null,[e[4]||(e[4]=t("我希望使用自定义化的")),i(l,{to:"/articles/control.html"},{default:a(()=>e[3]||(e[3]=[t("远程控制")])),_:1}),e[5]||(e[5]=t("方案。（高级）需求：虚拟组网，P2P"))])]),e[24]||(e[24]=r("h2",{id:"easytier",tabindex:"-1"},[r("a",{class:"header-anchor",href:"#easytier"},[r("span",null,[r("a",{href:"https://easytier.cn/",target:"_blank",rel:"noopener noreferrer"},"easytier")])])],-1)),e[25]||(e[25]=r("p",null,"新时代的虚拟组网软件，国人用 Rust 编写，有国内公益 server 做转发/rpc；跨多平台，有 GUI。除了文档垃圾一点，没有其他缺点了。",-1)),e[26]||(e[26]=r("p",null,[r("a",{href:"https://github.com/lxl66566/nixos-config/blob/6c540a241c4344d23fc070526debed885e7f91cb/others/network/easytier.nix",target:"_blank",rel:"noopener noreferrer"},"我的配置")],-1)),r("ul",null,[e[15]||(e[15]=r("li",null,"和 zerotier、tailscale 故意区分了不同端相比，easytier peer 是全对等的。包括官方的公益节点也是普通 peer，所有 peer 都可以传递信令、组织网络、中转流量。——Losarch",-1)),e[16]||(e[16]=r("li",null,[t("easytier 的文档非常大便，没有一个 full config example，全是命令行，那个配置生成器很难用而且有 bug。包括我刚需的 "),r("em",null,"peer 间 quic 通信"),t(" 是 undocumented 的。")],-1)),e[17]||(e[17]=r("li",null,"默认情况下它会将你的服务器连到大网络里，消耗你的流量；需要注意开启 private-mode 进行网络隔离，或者开启 relay-network-whitelist + relay-all-peer-rpc 只允许帮助 p2p 连接。",-1)),r("li",null,[e[7]||(e[7]=t("easytier 默认是")),e[8]||(e[8]=r("strong",null,"没有过墙能力",-1)),e[9]||(e[9]=t("的，但是如果把入端口搞得足够小，流量就可以走到 ")),i(l,{to:"/articles/proxy/#external"},{default:a(()=>e[6]||(e[6]=[t("quic 豁免")])),_:1}),e[10]||(e[10]=t("。（easytier 也可以接 socks5 代理但是我懒得搞）。所以 quic 对我来说是刚需，然而文档里的 quic 是子网代理 quic 而不是 peer 通信 quic，确实把我迷惑了一阵。要让 peer 走 quic，只要把 scheme 改为 ")),e[11]||(e[11]=r("code",null,"quic",-1)),e[12]||(e[12]=t("，选一个小端口，然后配置里添加 ")),e[13]||(e[13]=r("code",null,'flags.default_protocol = "quic";',-1)),e[14]||(e[14]=t(" 即可。"))])]),e[27]||(e[27]=n('<h2 id="cloudflare-tunnel" tabindex="-1"><a class="header-anchor" href="#cloudflare-tunnel"><span>cloudflare tunnel</span></a></h2><p>折腾完了其他几个服务我才想到 cloudflare，一搜，果然有。</p><p>cloudflare 的内网穿透是部署最简单，使用体验最好的服务，杀死了所有其他 frp 玩家。</p><ol><li>前往 <a href="https://one.dash.cloudflare.com/" target="_blank" rel="noopener noreferrer">cloudflare zero trust</a>，左侧选择 <em>Networks - Tunnels</em>，创建一个新的 tunnel。</li><li>根据提示在服务器上安装 cloudflared。提示中的 Linux 部分只包含了 rpm/deb 系，但是没有关系，直接到 <a href="https://github.com/cloudflare/cloudflared" target="_blank" rel="noopener noreferrer">Github cloudflared</a> 的 release 中下载对应架构 binary 文件。</li><li>执行 cloudflare 步骤里带有 token 的命令。</li></ol><p>就这么简单，可以说一行命令完成内网穿透也不为过。而且你永远可以相信 cloudflare 的延迟和稳定性。</p>',5)),r("p",null,[e[19]||(e[19]=t("不过 cloudflared 在 ")),i(l,{to:"/articles/linux/openwrt.html#%E6%9C%8D%E5%8A%A1"},{default:a(()=>e[18]||(e[18]=[t("procd")])),_:1}),e[20]||(e[20]=t(" 系统上只会将 service 写入 ")),e[21]||(e[21]=r("code",null,"/etc/init.d/cloudflared",-1)),e[22]||(e[22]=t("，并不会开机自启。如果需要开机自启，需要手动创建一个软链接："))]),e[28]||(e[28]=n('<div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/rc.d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ln</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ../init.d/cloudflared</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./S99cloudflared</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>实际使用 cloudflare tunnel 代理我的 reader server 时，出现过上传失败的问题。我不太确定是 server 锅还是 tunnel 锅。</p><h2 id="zerotier" tabindex="-1"><a class="header-anchor" href="#zerotier"><span>zerotier</span></a></h2><p><a href="https://openwrt.org/docs/guide-user/services/vpn/zerotier" target="_blank" rel="noopener noreferrer">据说</a> openwrt 是有 zerotier 的软件包的，但是我在 iStoreOS 里一点也找不到，不知道是 iStoreOS 的 fork 问题还是 opkg 的问题。</p><p>然后我想直接下载 binary，结果发现<a href="https://www.zerotier.com/download" target="_blank" rel="noopener noreferrer">下载页面</a>里只有 rpm/deb 系的，Github release 里也找不到 binary。合着其他发行版就不配装你的程序了？</p><p>zerotier 软件 UI 也都比较古老，网页不清晰，几个产品之间关系也比较混乱，一会儿把你推去 zerotier One，一会儿又踢回 zerotier，但是我没空，也没兴趣了解它们之间的关系。</p><p>之后我在被控端和受控端安装了 Zerotier One，然后将几个节点加入网络，我居然还不能直接从 Android 节点拿到被控端的 IP，要我登录网页去看。网页里也不显示 hostname，分不清设备。然后发现如果用 private 网络，我的几个节点都过不了 auth，呃呃，软件里哪有 auth 功能。只好在面板里把网络设成 public。</p><p>尝试远控，质量比 Tailscale 好点，但是还是达不到我的标准。码率不足，延迟 1s 以上。</p><h2 id="rathole" tabindex="-1"><a class="header-anchor" href="#rathole"><span><a href="https://github.com/rapiz1/rathole" target="_blank" rel="noopener noreferrer">rathole</a></span></a></h2><p>rathole 是一个 Github 开源项目，本身并不提供内网穿透的服务器；它需要在一台有公网 IP 的服务器上部署转发程序（server），并在内网服务器上部署 client。其实也就是相当于部署一个代理了。不过好在它的配置非常简单，只要写端口就行；而且是 Rust 写的，有编程语言原神之力加持，所以我还是尝试了一下。</p><p>程序很容易就跑起来了，唯一的问题是开机自启。公网服务器上是正常发行版（systemd），这个还好写，我之前做过一个 <a href="https://github.com/lxl66566/user-startup-rs" target="_blank" rel="noopener noreferrer">user-startup-rs</a>的程序，可以做到一键自启。但是 iStoreOS 用的是 procd，老式的 service 命令写服务，这 service 里还大量调用了 OpenWRT 的接口，学习成本和心智负担都不可忽视。</p><p>service 写完，可以跑起来了，结果实际使用时还整天断连，稳定性非常低。我猜测是 service 写出了问题，然而这又不像 systemd 接 journal，没有日志输出，调试非常不便。</p><p>同时因为我的公网服务器大多是月抛小鸡，每个月都要修改配置还是非常麻烦的，最后还是放弃了。</p><h2 id="tailscale" tabindex="-1"><a class="header-anchor" href="#tailscale"><span>Tailscale</span></a></h2><p>Tailscale 与 其开源实现 headscale 都是老牌的虚拟组网工具。Tailscale 免费版可以虚拟组网 100 台设备。安装很简单，对应平台下载安装包，登录就行。</p><p>但是实测下来，串流效果很差，视频完全无法显示。我猜这个组网并不是 P2P 的，免费服务器的带宽不够，无法承载串流流量。</p><p>Tailscale 还有一点不好用的地方，就是打开 Android APP 就要启动 VPN service，而不是手动点 connect 时启动。</p><h2 id="netbird" tabindex="-1"><a class="header-anchor" href="#netbird"><span>NetBird</span></a></h2><p>官网看着很现代化，让我抱有了一丝不切实际的希望。结果连接稳定性极低，进去以后也是码率不足黑屏。并且和 zerotier 一样也是无法在 APP 内看 IP。</p>',19))])}const g=s(u,[["render",h],["__file","frp.html.vue"]]),c=JSON.parse('{"path":"/articles/frp.html","title":"内网穿透","lang":"zh-CN","frontmatter":{"date":"2024-12-04T00:00:00.000Z","icon":"slash","category":["推荐","教程","评价"],"tag":["Linux","桌面端"],"description":"内网穿透 在 软路由上部署了应用后，我需要一个内网穿透让我在任何地点都能连上应用。需求：免费，稳定。 我希望使用自定义化的方案。（高级）需求：虚拟组网，P2P easytier 新时代的虚拟组网软件，国人用 Rust 编写，有国内公益 server 做转发/rpc；跨多平台，有 GUI。除了文档垃圾一点，没有其他缺点了。 我的配置 和 zerotier...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"内网穿透\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-12-04T00:00:00.000Z\\",\\"dateModified\\":\\"2025-12-16T15:14:20.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://absx.pages.dev/articles/frp.html"}],["meta",{"property":"og:site_name","content":"绝对值_x 的博客"}],["meta",{"property":"og:title","content":"内网穿透"}],["meta",{"property":"og:description","content":"内网穿透 在 软路由上部署了应用后，我需要一个内网穿透让我在任何地点都能连上应用。需求：免费，稳定。 我希望使用自定义化的方案。（高级）需求：虚拟组网，P2P easytier 新时代的虚拟组网软件，国人用 Rust 编写，有国内公益 server 做转发/rpc；跨多平台，有 GUI。除了文档垃圾一点，没有其他缺点了。 我的配置 和 zerotier..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-16T15:14:20.000Z"}],["meta",{"property":"article:tag","content":"桌面端"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:published_time","content":"2024-12-04T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-16T15:14:20.000Z"}]]},"git":{"createdTime":1733330711000,"updatedTime":1765898060000,"contributors":[{"name":"lxl66566","username":"lxl66566","email":"lxl66566@gmail.com","commits":9,"url":"https://github.com/lxl66566"}]},"readingTime":{"minutes":5,"words":1500},"filePathRelative":"articles/frp.md","localizedDate":"2024年12月4日","excerpt":"\\n","autoDesc":true}');export{g as comp,c as data};
