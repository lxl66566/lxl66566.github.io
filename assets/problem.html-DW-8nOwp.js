import{_ as r,e as l,f as n,g as s,h as i,i as t,j as o,r as p,o as d}from"./app-Uy65H9Kl.js";const c={};function h(u,e){const a=p("RouteLink");return d(),l("div",null,[e[26]||(e[26]=n('<h1 id="遇到的问题" tabindex="-1"><a class="header-anchor" href="#遇到的问题"><span>遇到的问题</span></a></h1><h2 id="如何减少问题" tabindex="-1"><a class="header-anchor" href="#如何减少问题"><span>如何减少问题</span></a></h2><p>老生常谈：</p><ol><li><code>pacman -Syu</code> 若更新了内核，立刻重启</li></ol><p>踩了很多坑，总结了点通用经验：</p><ol><li>干点什么之前，先备份（打快照）</li><li>干点什么之前，先去 <a href="https://luoxu.archlinuxcn.org/" target="_blank" rel="noopener noreferrer">Arch 落絮</a>搜一下关键词，看看别人有没有踩坑 <ul><li>nixos 也有 <a href="https://luoxu.torus.icu/" target="_blank" rel="noopener noreferrer">Nix 落絮</a></li></ul></li></ol><div class="hint-container tip"><p class="hint-container-title">提示</p><p>以下是正文，按时间倒序。越后面（越早）时犯的错越傻逼…</p></div><h2 id="nixos-bootloader" tabindex="-1"><a class="header-anchor" href="#nixos-bootloader"><span>NixOS bootloader</span></a></h2>',8)),s("p",null,[e[1]||(e[1]=i("由于")),t(a,{to:"/articles/linux/nix.html#nixos-%E5%AE%89%E8%A3%85"},{default:o(()=>e[0]||(e[0]=[i("一些原因")])),_:1}),e[2]||(e[2]=i("，")),e[3]||(e[3]=s("code",null,"nixos-enter",-1)),e[4]||(e[4]=i(" 后无法 rebuild。如果配置坏了那就只能 reinstall 了，但是如果只是 bootloader 坏了，还是有办法免安装救一下的，")),e[5]||(e[5]=s("code",null,"nixos-enter",-1)),e[6]||(e[6]=i(" 后 ")),e[7]||(e[7]=s("code",null,"/nix/var/nix/profiles/system/bin/switch-to-configuration --install-bootloader",-1)),e[8]||(e[8]=i(" 即可。"))]),e[27]||(e[27]=s("h2",{id:"nixos-调整风扇转速",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#nixos-调整风扇转速"},[s("span",null,"NixOS 调整风扇转速")])],-1)),e[28]||(e[28]=s("p",null,"未解决！",-1)),s("p",null,[e[10]||(e[10]=i("由于 ")),t(a,{to:"/articles/linux/nix.html#gaming"},{default:o(()=>e[9]||(e[9]=[i("nix gaming")])),_:1}),e[11]||(e[11]=i(" 的需求，需要调教性能。但是我的 nixos 的风扇就是转不起来，即使温度已经过 90 了。。。"))]),e[29]||(e[29]=n(`<p>nixos 原生支持 <a href="https://search.nixos.org/options?channel=unstable&amp;show=hardware.fancontrol.enable" target="_blank" rel="noopener noreferrer">fancontrol service</a>，但是需要一个配置文件。这个配置基本上都是用 pwmconfig 生成的，我跑这指令只能得到 <code>There are no pwm-capable sensor modules installed</code>。搜了一圈，找不到解。尝试了包括内核参数 <code>acpi_enforce_resources=lax</code>，加载 <code>coretemp</code> 内核模块，无效。</p><p>而其他调速软件例如 fan2go 也是基于 lm_sensors 的，显然无法使用。</p><p>如果不使用 fancontrol，各种三方软件缺乏维护，也需要手写配置，还没有文档。反正总线地址是绕不开的。还有许多三方是针对特定 PC 型号的，联想华硕都是机上机，可惜我这台七彩虹不在五型之中。</p><p>emm，最后还试了一下 wine 跑七彩虹的 game center，毫不意外地崩了。</p><p>有群友建议我使用 tuxedo-rs，试了一下也不行，<code>input=AddError(&quot;Bus response error: org.freedesktop.DBus.Error.InvalidArgs: No fan found at requested index&quot;)</code>。</p><h2 id="libvirt-虚拟机-network-not-found" tabindex="-1"><a class="header-anchor" href="#libvirt-虚拟机-network-not-found"><span>libvirt 虚拟机 Network not found</span></a></h2><p>我使用 libvirt + qemu kvm + Virtual Machine Manager (VMM) 进行虚拟机管理。然而在我用 archinstall 安装 arch 后，发现没装 dhcpcd，所有镜像的域名都无法解析。因此我需要再次挂载安装盘，进去装 dhcpcd。</p><p>然后去实验室上课，带着电脑，到那边启动虚拟机发现报错：<code>error: Network not found: no network with matching name &#39;default&#39;</code>。猜测是 active 的联网设备由网口变为 wifi 导致的。</p><p>使用 <code>virsh net-autostart default</code> 启动 default 配置，报错 <code>error: Network not found: no network with matching name &#39;default&#39;</code>。啊？然后去自定义一个 default：<code>sudo virsh net-define /var/lib/libvirt/qemu/networks/default.xml</code>（nixos 的默认路径）。然后再次 <code>virsh net-autostart default</code>，还是报一样的错误。我猜测是用了 sudo 的问题，define 的配置并不在当前用户上。因此我将此 xml 拷到 /tmp，更改 owner 和权限，不使用 sudo 进行 <code>virsh net-define</code> 并 start，成功。</p><h2 id="efi-空间不足" tabindex="-1"><a class="header-anchor" href="#efi-空间不足"><span>EFI 空间不足</span></a></h2><p>一些 Linux 新手（包括我）在第一次给 Linux 分区时都会将 EFI 分区分得过小。我分了 512M，之前在 Arch 最多也就同时用三个内核，而此次再加上了一堆 NixOS 的内核后终究是不堪重负，<code>no space left on device</code>。</p><p>于是我考虑为其扩容。在我的硬盘上，EFI 是第一个分区，而第二个刚好是 19GB 的 swap，这非常有利，我完全不需要考虑数据问题。使用 cfdisk，直接缩小 swap 分区会从后方缩小，因此需要删除 swap 分区，在扩大 EFI 分区后，再在原位置建立 swap 分区。</p><p>这还没完，EFI 分区扩大了，但是 filesystem 的大小是没变的（又被坑了一次，分完区还报错空间不足呢）。由于我的 Nixos 安装盘上并没有 fatresize（吐槽），并且系统进不去（说到底这个 bug 是我在解决另一个 bug 时出现的），所以只好使用笨办法，借用 swap 分区。</p><p>首先，上 cfdisk 把 swap 改成正常分区，然后 <code>mkfs.ext4</code>，挂载后把 EFI 的东西全部 cp 进去，再对 EFI 分区 <code>mkfs.vfat</code>。最后把数据移回去，swap 改回去就大功告成了。听着就麻烦。后来我自己做了 NixOS iso 并且把 fatresize 加进去了，不过估计是用不到了。（现在 EFI 有 2G）</p><p>改完千万别忘了调挂载里的 uuid。</p><h2 id="cfdisk-操作分区" tabindex="-1"><a class="header-anchor" href="#cfdisk-操作分区"><span>cfdisk 操作分区</span></a></h2><p>cfdisk 是一个非常好用的 TUI 分区工具，但是对于初次使用的人（其实不是初次，但是忘了），cfdisk 也可能成为一个坑。</p><p>所有在 cfdisk 里的操作都是<strong>模拟</strong>。在完成操作后需要执行一次 <code>写入（Write）</code> 才会被真正应用。<s>我说我怎么缩过的分区还会自己合起来的</s></p><h2 id="你的复制是真正的复制" tabindex="-1"><a class="header-anchor" href="#你的复制是真正的复制"><span>你的复制是真正的复制？</span></a></h2><p>在 windows 上将一个 2G 的镜像复制到 U 盘里要花上几分钟，而在 Archlinux 上是瞬间。而 U 盘的写入速度不可能超越瓶颈。很容易猜到后台有东西在对 U 盘进行写入。遂关机，发现 <code>A stop job is running for Disk Manager</code>，证毕。</p><h2 id="nixos-wsl-网络" tabindex="-1"><a class="header-anchor" href="#nixos-wsl-网络"><span>NixOS-WSL 网络</span></a></h2><p>首先，装好 NixOS-WSL 后，无法 <code>sudo nix-channel --update</code>。查看环境变量发现没有设代理，于是<a href="https://nixos-cn.org/tutorials/installation/Networking.html#_3-%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7%E5%8A%A0%E9%80%9F%E8%AE%BF%E9%97%AE-channels-%E8%B7%9F-flake-inputs" target="_blank" rel="noopener noreferrer">设了</a>，结果发现还是不行。然后想到 root 和 user 用的不是同一个 env，便进入 root 修改（需要用 <code>sudo -i</code> 进 root 而不是 <code>su</code>）。</p><p>在 root 下，<code>/run/systemd/system/nix-daemon.service.d/override.conf</code> 并不能在 env 中生效，因此我只好手动 <code>export https_proxy=http://localhost:10450</code> 代理环境变量，成功 update + rebuild。<s>然后一个更新就 5.6G 了</s></p><h2 id="kde6" tabindex="-1"><a class="header-anchor" href="#kde6"><span>KDE6</span></a></h2><p>KDE 在 20240306 左右释出了 KDE6，但是有一些需要手动处理的地方：</p><ul><li>我直接升级后遇到了破坏主题的情况，使 sddm 登录回退到默认主题。解法：<code>pacman -S layer-shell-qt5 plasma-framework5</code>. (<a href="https://t.me/archlinuxcn_group/3093488" target="_blank" rel="noopener noreferrer">ref</a>)</li><li>KDE6 带来了默认悬浮任务栏，但是刚开始的时候是有 bug 的，点击位置并没有悬浮，出现错位。后来虽然修了，但我也不想用悬浮了。解法：右击任务栏进入编辑模式，关闭悬浮。</li><li>KDE6 将默认打开行为由单击改为了双击，但我是单击党。因此我改回单击：在 <em>系统设置 - 工作区 - 常规行为</em> 里调。Dolphin 的设置里是没有的。</li></ul><h2 id="关机等待-90s" tabindex="-1"><a class="header-anchor" href="#关机等待-90s"><span>关机等待 90s</span></a></h2><p>首先把 timeout 改到 10s。</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> printf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;DEFAULT_TIMEOUT_SEC=10\\n&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/environment</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 不能 set -Ux DEFAULT_TIMEOUT_SEC 10，因为不读 fish 环境变量</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/systemd/system.conf</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># change this</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">DefaultTimeoutStartSec</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{{DEFAULT_TIMEOUT_SEC}}s</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">DefaultTimeoutStopSec</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{{DEFAULT_TIMEOUT_SEC}}s</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">DefaultDeviceTimeoutSec</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{{DEFAULT_TIMEOUT_SEC}}s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是并没有什么卵用。</p><p>后面多经历了几次，发现某些 wine 程序会导致这个问题。因此在关机前执行 <code>wineserver -k9</code>。</p><p>然后发现内核参数有个 <code>nowatchdog</code>，将此参数删除可能可以解决此问题。但是在 wiki 的性能优化中有提到，在桌面或笔记本个人电脑上没有必要开启 watchdog，我认为还是不要损失性能的更好。</p>`,32)),s("p",null,[e[13]||(e[13]=i("最后我的解法是 ")),t(a,{to:"/articles/linux/install_and_config.html#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE"},{default:o(()=>e[12]||(e[12]=[i("sysrq 键 (13.)")])),_:1}),e[14]||(e[14]=i("，这是一组能直接与内核交互的键。当我关机时出现等待时，按下 ")),e[15]||(e[15]=s("code",null,"Alt + Sysrq + I",-1)),e[16]||(e[16]=i(" 即可对其他进程发出 ")),e[17]||(e[17]=s("code",null,"SYSKILL",-1)),e[18]||(e[18]=i("，也就能够正常关机了。"))]),e[30]||(e[30]=n(`<h2 id="waydroid-的问题" tabindex="-1"><a class="header-anchor" href="#waydroid-的问题"><span>waydroid 的问题</span></a></h2><h3 id="启动失败" tabindex="-1"><a class="header-anchor" href="#启动失败"><span>启动失败</span></a></h3><p>安装 waydroid 不久后，<code>waydroid show-full-ui</code> 启动失败，命令行显示 <code>waydroid [gbinder] Service manager /dev/anbox-binder has appeared</code>，但是却没有打开图形界面。</p><p>重启后好了，再重启又炸了。</p><p><a href="https://github.com/waydroid/waydroid/issues/136#issuecomment-949694932" target="_blank" rel="noopener noreferrer">某个 issue</a> 讲设置内核启动参数，试了一下，无效。</p><p>此时想到要看 log，<code>waydroid log</code> 显示 <code>lxc-start: waydroid: ../src/lxc/conf.c: run_buffer: 322 Script exited with status 126</code>。</p><p>没辙，然后 <code>sudo waydroid init -f</code> 重装。然后就能用了。</p><p>后来又一次遇到了相同问题，这次拿了更多信息去搜，发现一个<a href="https://github.com/waydroid/waydroid/issues/294#issuecomment-1027392592" target="_blank" rel="noopener noreferrer">看起来不相似的 issue</a> 居然能解决我的问题，非常惊讶。</p><h2 id="timeshift-删除快照" tabindex="-1"><a class="header-anchor" href="#timeshift-删除快照"><span>timeshift 删除快照</span></a></h2><p>未解决！</p><p>我已经转 snapper 了，想删除所有 timeshift 的快照并卸载。然而有一个快照在删除中出现错误（真的太傻逼了）。于是我找到了<a href="https://bbs.archlinux.org/viewtopic.php?id=266965" target="_blank" rel="noopener noreferrer">这个回答</a>，发现问题基本是一样的。于是只要手动删除子卷就行了。</p><p>但是，我找不到子卷的位置。</p><blockquote><p>&gt; sudo timeshift --list<br> Mounted &#39;/dev/nvme1n1p3&#39; at &#39;/run/timeshift/36810/backup&#39;</p></blockquote><p><code>/run/timeshift</code> 文件夹是空的。后来又找到了<a href="https://bbs.archlinux.org/viewtopic.php?id=287094" target="_blank" rel="noopener noreferrer">其他人相同的遭遇</a>。That&#39;s STICKY！</p><h2 id="sddm-无法启动" tabindex="-1"><a class="header-anchor" href="#sddm-无法启动"><span>sddm 无法启动</span></a></h2><p>这是我遇到的第二个恶性 bug<sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup>（第一个是 <a href="#timeshift-%E5%BC%95%E5%8F%91%E7%9A%84%E8%A1%80%E6%A1%88">timeshift</a>）。</p><p><a href="https://t.me/withabsolutex/1331" target="_blank" rel="noopener noreferrer">log</a>，具体来说是启动全绿，而后左上角光标卡住不闪烁。<code>Ctrl + Alt + F1</code> 后进入 tty，屏幕显示方才的内核全绿消息，光标闪烁，但仍然无法输入任何字符。</p><p>我尝试：</p><ol><li>首先短按关机，用 archiso 挂载后 <code>arch-chroot</code> 进去，看日志，看内核消息，无相关报错。</li><li>重新 <code>mkinitcpio -p linux</code>，重启无效。</li><li>想到最后一条内核消息是 SDDM，绞尽脑汁，我今天干了啥呢，哦，我用了个 <code>nvidia-xconfig</code> 生成了 NVIDIA 配置。</li><li>重新 <code>arch-chroot</code>，去 <code>/etc/X11</code> 里根据修改日期删除生成的两个 <code>.conf</code> 文件，重启，问题解决。</li></ol><p>哎，NVIDIA 害人不浅。。而且 archwiki 并未指出双显卡不能使用 <code>nvidia-xconfig</code>。</p><h2 id="ubuntu-提示重启" tabindex="-1"><a class="header-anchor" href="#ubuntu-提示重启"><span>ubuntu 提示重启</span></a></h2><p>在公家服务器上 <code>apt update &amp;&amp; apt install ...</code>，然后出现一个 tui 界面提示 <em>new kernel available</em>，让我选要重启的服务。。由于不知道重启之后会多出什么问题，我按两次 ESC 退出了。</p><h2 id="timeshift-引发的血案" tabindex="-1"><a class="header-anchor" href="#timeshift-引发的血案"><span>timeshift 引发的血案</span></a></h2><blockquote><p>前情提要见<a href="#%E7%BD%91%E5%8D%A1%E9%97%AE%E9%A2%98">网卡问题</a>。</p></blockquote><ol><li><p>使用 timeshift 回退到 20+days 前，重启，发现错误：<em>Failed to mount /boot</em>。<code>journalctl -xb</code> 查看，找到：<em>unknown filesystem type &#39;vfat&#39;</em>。</p></li><li><p>搜了一阵，<code>uname -a</code> 显示我内核是 6.5.5，而回退到的时间点正在用内核 6.5.3，猜测是内核版本冲突。</p></li><li><p>去 archlinuxcn 群里问，果真，然后都在说是 timeshift 的锅。（本群又一个 timeshift 受害者）去 luoxu 找历史记录，出现回答 “<em>timeshift 不兼容 genfstab，生成出來的子卷掛載帶 subvolid= 參數的情況</em>” (<a href="https://t.me/archlinuxcn_group/2927677" target="_blank" rel="noopener noreferrer">ref</a>)</p></li><li><p>照着 13 天前另一个人的一模一样的问题走了一遍老路。具体的，进入 archiso 安装盘：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 挂载子卷 / 和 /boot（nvmexnxpx 填写实际驱动器号）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mount</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> btrfs</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> subvol=/@,compress=zstd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /dev/nvmexnxpx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /mnt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mount</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /dev/nvmexnxpx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /mnt/boot</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># chroot</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">arch-chroot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /mnt</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重装内核与软件包</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pacman</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Syu</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> linux</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 删掉 fstab 中的 subvolid...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nvim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/fstab</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重启</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">reboot</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>其实在折腾过程中还遇到各种脑残小问题，排查花了一些时间，这里按下不表。</p><blockquote><p>你是遇到问题才想到恢复到快照吗，下次建议直接修遇到的问题，只要解决 1 个问题。回滚的话你现在要修原本遇到的问题和因为回滚遇到的问题，共 2 个问题（</p><div style="text-align:right;"><p>——@Senaruk, <a href="https://t.me/archlinuxcn_group/2951737" target="_blank" rel="noopener noreferrer">ref</a></p></div></blockquote><h2 id="网卡问题" tabindex="-1"><a class="header-anchor" href="#网卡问题"><span>网卡问题</span></a></h2><p>连接网线使用时总是约每 5min 炸一次（以太网无 Internet 响应，回退到使用 wlan0）。去 Realtek 下载网卡驱动，README 让执行一个自动脚本，<code>sudo bash xxx.sh</code> 把我原来网卡驱动卸(禁用?)掉以后就报错强退了。。。（写的什么屎山，真不负责啊）于是没有 eth0 用了。</p><p>搜索解法无果，想着用 timeshift 回退到爆炸前，但是快照打得不勤，只能回退到 20+days 前，于是就发生了<a href="#timeshift-%E5%BC%95%E5%8F%91%E7%9A%84%E8%A1%80%E6%A1%88">timeshift 引发的血案</a>——</p><h2 id="安装-osu" tabindex="-1"><a class="header-anchor" href="#安装-osu"><span>安装 OSU</span></a></h2><p>首先<a href="https://osu.ppy.sh/community/forums/topics/1248084?n=1" target="_blank" rel="noopener noreferrer">教程在这</a>。</p><p>安装时显示没网，是我 daed 透明代理的锅，<code>curl google.com</code> 正常但是 ping 不动。把脚本那行 ping 验证注释掉就行了。后面安装可能会缺东西，照着提示装。</p><p>装完后没有 <code>osu-wine</code> 被添加到环境变量，不能直接执行；<code>osu-wine</code> 脚本在 <code>git clone</code> 那个目录，使用绝对路径即可。</p><p>这样用 wine 装好的 osu 游戏时只能跑到 170 帧（windows 上 1k+ fps），使用 <code>nvtop</code> 查看，果然跑在核显上，需要 <code>prime-run</code>。这个 <code>prime-run</code> 还不是随便加的，我在 krunner 里加了以后帧率没有变化，但是 <code>nvtop</code> 是有输出的。我一直以为有什么其他问题，直到我看到了<a href="https://github.com/NelloKudo/osu-winello/wiki/(Possibly)-optimize-your-game:-Gamemode#installing-gamemode" target="_blank" rel="noopener noreferrer">这个</a>，我才发现加错了位置，需要加到 <code>~/.local/bin/osu-wine</code> 脚本里。（对，这是个脚本）</p><p>现在又出现了音频问题，pipewire 下无法正常播放，唉。</p><h2 id="更新破坏依赖" tabindex="-1"><a class="header-anchor" href="#更新破坏依赖"><span>更新破坏依赖</span></a></h2><p>四个字，<strong>先删再装</strong>。参考<a href="https://bbs.archlinuxcn.org/viewtopic.php?id=10208" target="_blank" rel="noopener noreferrer">forum</a>，问题可能是有游离的软件包，也可能是上游改了依赖。</p><p>相信我，这个问题以后还会经常出现。</p><h2 id="nvim-剪贴板问题" tabindex="-1"><a class="header-anchor" href="#nvim-剪贴板问题"><span>nvim 剪贴板问题</span></a></h2><p>我在 <code>option.lua</code> 中有设置 <code>vim.opt.clipboard = &#39;unnamedplus&#39;</code>，之前运作挺好，但自从换了 X11 以后就不能再复制。</p><p>解法也很简单，安装 <code>xclip</code> 即可。</p><h2 id="yay-权限错误" tabindex="-1"><a class="header-anchor" href="#yay-权限错误"><span>yay 权限错误</span></a></h2><p>使用 <code>yay</code> 安装 <code>wine-stable</code> 时出现了一些问题。</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>-&gt; 无法安装以下软件包, 需要手动介入处理:</span></span>
<span class="line"><span>lib32-http-parser - exit status 4</span></span>
<span class="line"><span>lib32-libheif - exit status 8</span></span>
<span class="line"><span>lib32-libgphoto2 - exit status 8</span></span>
<span class="line"><span>lib32-libxpm - exit status 1</span></span>
<span class="line"><span>lib32-libgit2 - exit status 8</span></span>
<span class="line"><span>lib32-gd - exit status 8</span></span>
<span class="line"><span>wine-stable - exit status 8</span></span>
<span class="line"><span>lib32-libraqm - exit status 4</span></span>
<span class="line"><span>lib32-rav1e - exit status 8</span></span>
<span class="line"><span># 详细报错：</span></span>
<span class="line"><span>make: ./test_g: 权限不够make: *** [Makefile:76：test] 错误 127</span></span>
<span class="line"><span>==&gt; 错误： 在 check() 中发生一个错误。正在放弃...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中大多数是权限错误。但是我用 paru 安装就可以成功安装。</p>`,46)),s("p",null,[e[20]||(e[20]=i("结果发现是下载目录的 tmpfs 开了 ")),e[21]||(e[21]=s("code",null,"noexec",-1)),e[22]||(e[22]=i(" 导致的。而同时由于 paru 的 clonedir 是 ")),t(a,{to:"/articles/linux/#%E8%AE%BE%E7%BD%AE"},{default:o(()=>e[19]||(e[19]=[i("bind to tmpfs")])),_:1}),e[23]||(e[23]=i(" 的，没有加 ")),e[24]||(e[24]=s("code",null,"noexec",-1)),e[25]||(e[25]=i("，于是可以正常使用。。。（乐"))]),e[31]||(e[31]=n(`<h2 id="输入法不显示" tabindex="-1"><a class="header-anchor" href="#输入法不显示"><span>输入法不显示</span></a></h2><p>在<a href="#%E9%87%8D%E8%A3%85-ubuntu">安装了 kubuntu</a> 后，设置页默认不显示输入法。在语言页面一看，简体中文是残缺的，警告需要 Install Missing Packages。但是我无法直接在 kde ui 里直接下载安装，点击了过一阵子又是残缺警告（包括 kde ui 也没法更新软件）。</p><p>解法是 <code>sudo apt install $(check-language-support)</code>。然后注销，再 login 就有输入法了。</p><h2 id="日文输入法" tabindex="-1"><a class="header-anchor" href="#日文输入法"><span>日文输入法</span></a></h2><p>需要安装日文输入法，去 archwiki 日语页面看，选择了 <code>mozc</code>。然后我就直接 <code>yay -S mozc</code> 了，，装是装了，然而没法使用。。</p><p>后来发现我使用 fcitx5 的话需要装 fcitx5 的 mozc utils（包名是<code>fcitx5-mozc-ut</code>）。然后就没啥问题了。</p><blockquote><p><s>吐槽一下，mozc 源码有 600+MB，然而 bin 只有 30MB，编译还风扇起飞转了好久。只能说体会到了编译源码的不便。</s></p></blockquote><h2 id="重装-ubuntu" tabindex="-1"><a class="header-anchor" href="#重装-ubuntu"><span>重装 ubuntu</span></a></h2><p>在别人的电脑上<s>乱搞</s>，装了 intel 核显驱动然后没有重启就 <code>sudo apt install vim</code>（是的，没有 vim）；然后 gnome 就已经开始出问题了，重启键消失了。这时候我还没有意识到，直接 <code>sudo reboot</code>，再次开机就内核加载失败了。。</p><p>然后尝试修复。能进 tty，但什么都没有，ifconfig 没有，<code>iwconfig</code> or <code>ls /sys/class/net</code> 只显示 <code>lo</code>，也就是说找不到网卡了。。那没网我能干啥，<s>vi 进去修吗？</s></p><p>还好没啥重要数据。授权后重装了 kubuntu。然后发现 kde 爆杀 gnome（二嘲）。</p><p>有一说一，我不喜欢 ubuntu 这样臃肿的系统。<s><a href="https://t.me/archlinuxcn_group/2896194" target="_blank" rel="noopener noreferrer">其他观点</a>，看上下文</s> 但是是帮别人装，还是别搞什么 archlinux（哪天滚挂了都不会修）和 nixos（小众，问题解法少）了。</p><blockquote><p>出现此问题时我是纯正小白，能力不足.jpg</p></blockquote><h2 id="中文设置问题" tabindex="-1"><a class="header-anchor" href="#中文设置问题"><span>中文设置问题</span></a></h2><p>在语言中设置了中文，重启后 kde 有部分 ui 变为英文。</p><p>原因：更改 <code>/etc/locale.gen</code> 后没有运行 <code>sudo locale-gen</code>。运行即可。</p><h2 id="yay-换源问题" tabindex="-1"><a class="header-anchor" href="#yay-换源问题"><span>yay 换源问题</span></a></h2><p>刚开始一直以为 yay 就是类似 pacman 的 extra，所以想要给 yay 换源。根据简中内网的傻逼教程（没错，此时还没上代理），换了个已经废弃的清华源（换源指令：<code>yay --aururl &quot;https://...&quot; --save</code>），发现用不了后换成了中科大源，结果报错：</p><blockquote><p>-&gt; 查找 AUR 软件包失败： ttf-ms-win11-auto-zh_cn:1 error occurred:<br> * response decoding failed: invalid character &#39;&lt;&#39; looking for beginning of value</p></blockquote><p>并且换回官方源仍然相同报错。换源过去然后发现换不回来，堪比刷小米 EU<sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup>.</p><p>之后发现，在 <code>~/.config/yay/config.json</code> 中有一个 <code>aurrpcurl</code> 字段，会保留上一个换源的结果(?) 并且不会自动更换回去。于是我删除该条，重新执行 <code>yay --aururl &quot;https://aur.archlinux.org&quot; --save</code>，问题得解。如果一次不行就两次，一定能解(?)。</p><p>ps. 群友提出了 <code>yay --aurrpcurl &#39;https://aur.archlinux.org&#39; --save</code></p><h2 id="umount-failed" tabindex="-1"><a class="header-anchor" href="#umount-failed"><span>umount failed</span></a></h2><p><code>sudo umount /mnt/windows</code>，提示</p><blockquote><p>/mnt/windows: 目标忙</p></blockquote><p>估计有莫名奇妙的软件在占用。直接 <code>lsof /mnt/windows</code> 查占用，然后再 <code>kill -9 &lt;PID&gt;</code> 强关。</p><h2 id="windows-字体问题" tabindex="-1"><a class="header-anchor" href="#windows-字体问题"><span>Windows 字体问题</span></a></h2><p>根据<a href="https://arch.icekylin.online/guide/advanced/optional-cfg-1.html#%E5%AE%89%E8%A3%85-windows-%E5%AD%97%E4%BD%93" target="_blank" rel="noopener noreferrer">教程</a>复制 windows 字体，<span class="heimu" title="你知道的太多了">打错大小写就先不说了，纠正以后</span>提示：</p><blockquote><p>cp: 对 &#39;./yuminl.ttf&#39; 调用 stat 失败: 没有那个文件或目录</p></blockquote><p>后来使用 <code>yay -S ttf-ms-win11-auto-zh_cn</code> 安装字体也失败，中间报 warning 一大堆。</p><p>没辙，暂时用 U 盘拷吧。</p><h2 id="yay-安装问题" tabindex="-1"><a class="header-anchor" href="#yay-安装问题"><span>yay 安装问题</span></a></h2><p>使用 <code>sudo pacman -S yay</code> 时一直报错，<code>signature is unknown trust</code> 类似的。怀疑是 pacman-keyring 问题，去前面 <a href="#%E6%9B%B4%E6%96%B0-pacman-keyring">更新 pacman-keyring</a> 试了好久，都不行。</p><p>后面看教程，发现需要先安装 cn 源中的签名：<code>sudo pacman -S archlinuxcn-keyring</code>，然后才能正常使用。。（因为 pacman 用的是 archlinuxcn 源）</p><h2 id="networkmanager-warning" tabindex="-1"><a class="header-anchor" href="#networkmanager-warning"><span>NetworkManager warning</span></a></h2><p>设置自启服务 <code>systemctl enable --now NetworkManager</code> 时报错：</p><blockquote><p>... iwlwifi ... WRT: invalid buffer destination</p></blockquote><p>不过后面 <code>systemctl status NetworkManager</code> 发现服务已经启动了，也就没管了（所以问题还是没解决的，然而图形界面后开机自启看不到报错了）</p><p>ps. 实际上 linux 下不明所以的 warning, error 好多的（详见 <code>journalctl</code> or <code>dmesg</code>），都是<strong>能用就别管</strong>原则</p><h2 id="挂载出错" tabindex="-1"><a class="header-anchor" href="#挂载出错"><span>挂载出错</span></a></h2><p>非常低级的错误。。挂载时打错了指令，导致不同的分区被挂载到了同一个位置。不过检查得早，没有继续下一步就发现了问题。</p><p>然后重新挂载，后来到 <em>生成 fstab 文件</em> 的时候又发现了怪事：<code>genfstab -U /mnt &gt; /mnt/etc/fstab</code> 输出了一大堆东西，我读了一下，原来把我挂载时做的所有操作（包括错误部分）都记录进去了。于是手动删除了冗余，后续重启工作正常。</p><p>这个文件用于指示开机挂载。包括后来挂内存盘也是从这里改。</p><h2 id="分区格式化" tabindex="-1"><a class="header-anchor" href="#分区格式化"><span>分区格式化</span></a></h2><p>使用 <code>cfdisk</code> 分好区，需要分别为每个分区进行格式化。然而我使用 nvme 盘而看的 sata 指令，对硬盘格式化而非对分区进行格式化（错误示范：<code>mkfs.vfat /dev/nvme1n1</code>），报错：</p><blockquote><p>Partitions or virtual mapping on device, not making file system. (use -I to override)</p></blockquote><p>然后尝试了 <code>-I</code>，结果分区全没了；对着 <code>nvme1n1</code> <code>mkswap</code>，分区又炸了（全盘格成了 swap）。最后才发现格式化是分区操作，而不是硬盘操作。。非常的萌新非常的弱智。</p><h2 id="更新-pacman-keyring" tabindex="-1"><a class="header-anchor" href="#更新-pacman-keyring"><span>更新 pacman keyring</span></a></h2><p>遇到问题：使用 pacman 安装时报错</p><blockquote><p>error: python-cairo: signature from &quot;Caleb Maclennan <a href="mailto:alerque@archlinux.org" target="_blank" rel="noopener noreferrer">alerque@archlinux.org</a>&quot; is unknown trust</p></blockquote><ol><li><p>尝试执行 <code>pacman-key --refresh-keys</code>，但是效率感人</p></li><li><p><a href="https://www.reddit.com/r/archlinux/comments/sorhb1/how_long_does_a_pacmankey_refreshkeys_take/" target="_blank" rel="noopener noreferrer">据此所述</a>：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mv</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/pacman.d/gnupg{,.bak}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pacman-key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --init</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pacman-key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --populate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> archlinux</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然而没什么软用，还是报相同错误</p></li><li><p>更新 <code>archlinux-keyring</code> 本身：<code>sudo pacman -Sy archlinux-keyring</code>，问题解决</p></li></ol><div class="hint-container tip"><p class="hint-container-title">提示</p><p>裝 <code>archlinux-keyring</code> 其實就是在跑 <code>pacman-key --populate archlinux</code></p><div style="text-align:right;"><p>——farseerfc 😂, <a href="https://t.me/archlinuxcn_group/2911740" target="_blank" rel="noopener noreferrer">src</a></p></div></div><p>所以遇到 keyring 问题就先装 keyring 准没错（也适用于 <code>archlinuxcn-keyring</code>）。</p><h2 id="libcuda-so-1-is-not-a-symbolic-link" tabindex="-1"><a class="header-anchor" href="#libcuda-so-1-is-not-a-symbolic-link"><span><a href="https://bbs.archlinuxcn.org/viewtopic.php?id=13402" target="_blank" rel="noopener noreferrer">libcuda.so.1 is not a symbolic link</a></span></a></h2><p>Windows WSL 的锅，<a href="https://github.com/microsoft/WSL/issues/5548" target="_blank" rel="noopener noreferrer">解法</a>，但还有问题残留。</p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p>个人定义需要使用 archiso 进 arch-chroot 的都叫恶性。 <a href="#footnote-ref1" class="footnote-backref">↩︎</a></p></li><li id="footnote2" class="footnote-item"><p>参考<a href="../mobile_setting#mipad-5">刷机</a> <a href="#footnote-ref2" class="footnote-backref">↩︎</a></p></li></ol></section>`,57))])}const m=r(c,[["render",h],["__file","problem.html.vue"]]),f=JSON.parse('{"path":"/articles/linux/problem.html","title":"遇到的问题","lang":"zh-CN","frontmatter":{"date":"2023-10-11T00:00:00.000Z","icon":"regular fa-circle-xmark","category":["经历","问题"],"tag":["桌面端","工具","Linux"],"description":"遇到的问题 如何减少问题 老生常谈： pacman -Syu 若更新了内核，立刻重启 踩了很多坑，总结了点通用经验： 干点什么之前，先备份（打快照） 干点什么之前，先去 Arch 落絮搜一下关键词，看看别人有没有踩坑 nixos 也有 Nix 落絮 提示 以下是正文，按时间倒序。越后面（越早）时犯的错越傻逼… NixOS bootloader 由于，n...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"遇到的问题\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-10-11T00:00:00.000Z\\",\\"dateModified\\":\\"2025-07-08T15:04:03.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://absx.pages.dev/articles/linux/problem.html"}],["meta",{"property":"og:site_name","content":"绝对值_x 的博客"}],["meta",{"property":"og:title","content":"遇到的问题"}],["meta",{"property":"og:description","content":"遇到的问题 如何减少问题 老生常谈： pacman -Syu 若更新了内核，立刻重启 踩了很多坑，总结了点通用经验： 干点什么之前，先备份（打快照） 干点什么之前，先去 Arch 落絮搜一下关键词，看看别人有没有踩坑 nixos 也有 Nix 落絮 提示 以下是正文，按时间倒序。越后面（越早）时犯的错越傻逼… NixOS bootloader 由于，n..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-07-08T15:04:03.000Z"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:tag","content":"工具"}],["meta",{"property":"article:tag","content":"桌面端"}],["meta",{"property":"article:published_time","content":"2023-10-11T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-07-08T15:04:03.000Z"}]]},"git":{"createdTime":1696988501000,"updatedTime":1751987043000,"contributors":[{"name":"lxl66566","username":"lxl66566","email":"18259734087@163.com","commits":30,"url":"https://github.com/lxl66566"}]},"readingTime":{"minutes":16.45,"words":4935},"filePathRelative":"articles/linux/problem.md","localizedDate":"2023年10月11日","excerpt":"\\n","autoDesc":true}');export{m as comp,f as data};
