import{_ as r,r as k,o as d,c as o,a as s,b as i,d as t,w as a,e as l}from"./app-C2ZG1XV2.js";const c={},g=l(`<h1 id="数据库" tabindex="-1"><a class="header-anchor" href="#数据库"><span>数据库</span></a></h1><p>本人并没有深入学习数据库，日常都是简单的基础使用。因此事先声明，不要对此文抱有过高的期望。</p><h2 id="数据库选择" tabindex="-1"><a class="header-anchor" href="#数据库选择"><span>数据库选择</span></a></h2><p>大概分为关系型和非关系型，分布式和非分布式，嵌入和非嵌入，还有向量数据库等...</p><p>首先有一个很重要的概念，有跟随程序分发到客户端的文件数据库（嵌入式数据库），也有作为服务器端具有本地驱动的数据库。前者的关系型主要就是 SQLite，其他常见数据库基本都属于后者。所以在 java 连接 Mysql 时出现的 <code>jdbc:mysql://localhost:3306/mydatabase</code> 就是需要先启动数据库的服务驱动，在电脑上开个端口才能使用，不像 SQLite 直接读文件。由于我初期不知道这个概念，走了很多弯路。（<s>本人只是个臭写小玩意应用的，服务端数据库是什么，没听说过。</s>）</p><p>然后关系型和非关系型不多说，非关系型大部分都是 KV（key-value）数据库。</p><p>如何选择：</p><ol><li>嵌入式 <ul><li>关系型大多是 SQLite，新兴的有 <a href="https://duckdb.org/" target="_blank" rel="noopener noreferrer">duckdb</a>。</li><li>KV 首选 rocksdb，据说性能高。其他还有 redb (pure rust)。</li></ul></li><li>非嵌入式 <ul><li>关系型 <ul><li>MySQL/MariaDB<sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup><sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup> 最为泛用，学习简单，但是确实有点老了。</li><li>PostgreSQL 这玩意非常全能，属于宗教级别。</li><li>Oracle 商用要买授权，但是挺多外企用这个的。复杂是复杂，不过非常强。</li></ul></li><li>非关系型，纯内存的选 Redis</li><li>分布式 Cassandra</li></ul></li></ol><h2 id="可视化工具" tabindex="-1"><a class="header-anchor" href="#可视化工具"><span>可视化工具</span></a></h2><p>要求：免费，易用，通用。</p><p>用过 DBeaver，java 写的垃圾，bug 很多。</p><p>后来换了 Beekeeper Studio，只读非常好用，写的话一般。</p><h2 id="sql-语法基础" tabindex="-1"><a class="header-anchor" href="#sql-语法基础"><span>SQL 语法基础</span></a></h2><p>现在 GPT 写 sql 已经很厉害了，写项目只需要能看懂即可；如果面试就得掌握了。</p><h3 id="学习路线" tabindex="-1"><a class="header-anchor" href="#学习路线"><span>学习路线</span></a></h3><p>学习 sql 语法其实很简单。分几步走：</p><ol><li>基础：即单表查询，如何选表名，如何拿想要的字段并初步处理。<a href="https://www.runoob.com/sqlite/sqlite-commands.html" target="_blank" rel="noopener noreferrer">菜鸟教程</a></li><li>进阶：多表查询，可以看看 <a href="https://www.bilibili.com/video/av436892344/" target="_blank" rel="noopener noreferrer">这个视频</a>。</li><li>性能：深入原理，学习索引的作用，查询技巧；其他性能优化（分表分库等）。 <ul><li>索引详解，可以看<a href="https://www.bilibili.com/video/av951719613" target="_blank" rel="noopener noreferrer">这个视频</a>的前 11 p。</li><li><a href="https://www.runoob.com/mysql/mysql-index.html" target="_blank" rel="noopener noreferrer">索引语法</a></li></ul></li><li>其他依赖于特定数据库的实现，例如隔离级别与锁。这些跟 SQL 语法本身就没什么关系了。</li></ol><h3 id="引号" tabindex="-1"><a class="header-anchor" href="#引号"><span>引号</span></a></h3><ul><li>反引号主要用于库名和表名，可以让关键字失效。例如：<code>user</code> 是关键字必需用反引号。</li><li>字符串使用单引号，MySQL 使用双引号等价</li></ul><h3 id="基础语句" tabindex="-1"><a class="header-anchor" href="#基础语句"><span>基础语句</span></a></h3><p>看例子就行了。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 简单增删改</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tablename (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, xxx) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Alice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">25</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tablename </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> xxx </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 26</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> email </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;alice@example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">DELETE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> email </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;alice@example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT DISTINCT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tablename;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- DISTINCT 表示只列出不同项目</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 复杂查示例：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    o</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">order_id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">customer_name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    o</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">order_date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">    SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">oi</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">quantity</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> p</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">price</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> total_amount,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">    COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">oi</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">product_id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> total_items</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> orders o</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> customers c </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">customer_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">customer_id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> order_items oi </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">order_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> oi</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">order_id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> products p </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> oi</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">product_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> p</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">product_id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">order_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> BETWEEN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;2023-01-01&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;2023-12-31&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">region</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;North America&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  AND</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> p</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">category_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> IN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> category_id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> categories</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> category_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">LIKE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;%Electronics%&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">GROUP BY</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">order_id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">customer_name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">o</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">order_date</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">HAVING</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> total_amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 500</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> total_amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">DESC</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">o</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">order_date</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ASC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">LIMIT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> OFFSET </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="多表查询" tabindex="-1"><a class="header-anchor" href="#多表查询"><span>多表查询</span></a></h3><ul><li><a href="https://github.com/guobinhit/mysql-tutorial/blob/master/articles/foreign-key.md" target="_blank" rel="noopener noreferrer">外键的创建</a>：先创建一个正常数据（与关联的类型一致），再进行关联：<code>foreign key(外键字段) + references + 外部表名(主键字段);</code><ul><li><a href="https://www.cnblogs.com/itjeff/p/11578721.html" target="_blank" rel="noopener noreferrer">级联</a>：如果表 A 有 foreign key 关联到表 B，那么在 B 变动时可以让相关的 A 的行也变动。常用的有 <code>on delete cascade</code>（B 删除项时，A 也删除）</li></ul></li><li>直接 <code>select * from table1, table2</code> 出来的是两表的笛卡尔积</li><li>内连接（显式）：<code>SELECT 字段列表 FROM 表1 [INNER] JOIN 表2 ON 连接条件...</code></li><li>左外连接（所有的表 1 数据 + 交集）：<code>SELECT 字段列表 FROM 表1 LEFT [OUTER] JOIN 表2 ON 条件</code></li><li>右外连接：一般转为左外形式</li><li>自连接：给自己的表添加两个 alias，然后当成两张不相关的表用。</li></ul><h3 id="集合操作" tabindex="-1"><a class="header-anchor" href="#集合操作"><span>集合操作</span></a></h3><p>对<strong>多次</strong>查询的结果取并集或交集的操作。</p><ul><li>联合查询： <ul><li>两个 select 语句使用 <code>union all</code> 拼接：相当于两张表直接拼接。</li><li><code>union</code> 会去重。</li><li>双表列数必需一致，否则报错</li></ul></li><li>子查询：在首次查询的结果中继续查询。子句加 <code>()</code>。 <ul><li>子查询返回单个值：正常使用</li><li>子查询返回一行或一列：当成集合使用，一般有 <code>in</code>, <code>not in</code>, <code>any</code>, <code>all</code></li><li>子查询返回一表：一般需要 <code>select ... where (A, B) in (select ...)</code> 的形式，代表满足子表中任意一行的要求</li></ul></li></ul><h2 id="sqlite" tabindex="-1"><a class="header-anchor" href="#sqlite"><span>SQLite</span></a></h2><p>SQLite 没有驱动，没有压缩，没有加密，非常简单的数据库，可以被分发。作为开发者，也可以装一个 CLI 驱动，方便调试。</p>`,29),y=s("code",null,"scoop install sqlite",-1),B=l(`<h3 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h3><ul><li>Android Sqlite，<code>CREATE TABLE</code> 内部不允许尾随逗号。</li></ul><h3 id="压缩" tabindex="-1"><a class="header-anchor" href="#压缩"><span>压缩</span></a></h3><p>SQLite 本身不具备压缩功能，而我非常看重压缩，因此我使用 <a href="https://github.com/phiresky/sqlite-zstd" target="_blank" rel="noopener noreferrer">sqlite-zstd</a> 进行压缩。</p><p>具体使用，我试过 rust crates，结果发现 sqlite-zstd 和 rusqlite 的依赖冲突了(?)，python3 的库就嗯装不上。。因此只能使用最基本的 dll，即在 <code>.open</code> 后 <code>.load sqlite_zstd.dll</code>，dll 是在 Release 里下的，然后调用 <code>select zstd_enable_transparent(...);</code> 和 <code>select zstd_incremental_maintenance(null, 0.05);</code>，效果其实不是很理想：其压缩功能只针对 <code>TEXT / BLOB</code> 类型才可使用，同时具有一定额外开销。</p><p>嘛，我真正需要的压缩大概是透明压缩的吧...</p><h3 id="python" tabindex="-1"><a class="header-anchor" href="#python"><span>python</span></a></h3><div class="language-py line-numbers-mode" data-highlighter="shiki" data-ext="py" data-title="py" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> sqlite3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">conn </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> sqlite3.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;xx.sqlite&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">cursor </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> conn.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">cursor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">cursor.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&quot;&quot;create table if not exists sheetname(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    user1 varchar not null,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    user2 varchar,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    money real</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">)&quot;&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">cursor.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&quot;&quot;insert into sheetname values(..., ..., ...)&quot;&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">conn.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">commit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">cursor.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">conn.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rust" tabindex="-1"><a class="header-anchor" href="#rust"><span>rust</span></a></h3>`,9),u=l(`<h2 id="duckdb" tabindex="-1"><a class="header-anchor" href="#duckdb"><span>duckdb</span></a></h2><p>duckdb 比 sqlite 具有更多的功能。</p><p>python 版本还有一个<a href="https://duckdb.org/docs/guides/python/ibis.html" target="_blank" rel="noopener noreferrer">官方推荐的 orm</a> 可用。</p><p>rust 没有 duckdb 的原生实现，需要 bind c。</p><h2 id="redis" tabindex="-1"><a class="header-anchor" href="#redis"><span>Redis</span></a></h2><p>Redis 是一个非常简单的内存 KV (key-value) 数据库，主要用来做缓存。</p><h2 id="mysql-基础" tabindex="-1"><a class="header-anchor" href="#mysql-基础"><span>MySQL 基础</span></a></h2><ul><li>存储引擎： <ul><li>InnoDB（默认）支持事务和外键，而 MyISAM 不支持。</li><li>InnoDB 中一定有主键，主键一定是聚簇索引；MyISAM 使用的是非聚簇索引，没有聚簇索引。</li><li>大量数据的全表扫描，MyISM 空间性能更好。</li></ul></li><li>锁： <ul><li>InnoDB 提供表锁和行锁。 <ul><li>行锁：<code>SELECT ... LOCK IN SHARE MODE</code> 是读锁，<code>SELECT ... FOR UPDATE</code> 是写锁。</li><li>表锁：<code>LOCK TABLES table_name READ</code> 和 <code>LOCK TABLES table_name WRITE</code>。需要显式解锁：<code>UNLOCK TABLES</code>。</li></ul></li><li>MyISAM 虽然不支持事务，但是其 select 和 insert/update/delete 会自动加表读/写锁。</li></ul></li><li>分析： <ul><li>语句前 + <code>explain</code> 分析此语句的详情，是否走索引。</li><li><code>ANALYZE TABLE my_table;</code> 分析并存储表的关键字分布，用于优化查询。</li><li><code>OPTIMIZE TABLE my_table;</code> 整理碎片。</li></ul></li></ul><h3 id="常用数据类型" tabindex="-1"><a class="header-anchor" href="#常用数据类型"><span>常用数据类型</span></a></h3><ul><li>整数：TINYINT，SMALLINT，MEDIUMINT，INT，BIGINT；字节数分别 1 2 3 4 8</li><li>小数：FLOAT（4），DOUBLE（8），DECIMAL（精确）</li><li>时间：DATETIME，TIMESTAMP</li><li>字符串：VARCHAR(M)（可调最大长度 1-65535）（一般不用 TEXT，因为 VARCHAR 能建索引，但是 TEXT 不行）</li><li>二进制：VARBINARY(M)（可调最大长度 1-65535），BLOB（相当于 VARBINARY(65535)）</li></ul><h3 id="基础改查" tabindex="-1"><a class="header-anchor" href="#基础改查"><span>基础改查</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">mysql </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">p  # 登录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">show databases;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> xxx;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">show tables;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> sID</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;xxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">delete</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> sID</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;xxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> sBalance </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">00</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> where</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> sID</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;...&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mysql-运维" tabindex="-1"><a class="header-anchor" href="#mysql-运维"><span>MySQL 运维</span></a></h2><p>虽然之前说 MySQL 已经老了，但是由于其比较简单，现在还有非常多的企业在用，面试也是高频考点。学习一些 MySQL 并不影响对其他关系型数据库的掌握。</p><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h3>`,15),A=s("p",null,[i("有了 Mariadb 的"),s("a",{href:"#%E5%AE%89%E8%A3%85-mariadb"},"前车之鉴"),i("，安装 mysql 不再是问题——")],-1),m=s("div",{class:"language-sh line-numbers-mode","data-highlighter":"shiki","data-ext":"sh","data-title":"sh",style:{"--shiki-light":"#24292e","--shiki-dark":"#abb2bf","--shiki-light-bg":"#fff","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes github-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," pacman"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}}," -S"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," mysql")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," chmod"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," +rx"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," /var/lib/mysql")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," rm"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}}," -rf"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," /var/lib/mysql/"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}},"*")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," mysqld"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}}," --initialize"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}}," --user=mysql"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}}," --basedir=/usr"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}}," --datadir=/var/lib/mysql")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," systemctl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," start"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," mysqld")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," mysqld")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),b=s("p",null,[i("如果真的这么想，"),s("a",{href:"#%E5%AE%89%E8%A3%85-mysql"},"那就大错特错了"),i("。")],-1),D=s("p",null,"Windows 上安装 mysql 也少不了各种折腾。",-1),C=s("div",{class:"language-sh line-numbers-mode","data-highlighter":"shiki","data-ext":"sh","data-title":"sh",style:{"--shiki-light":"#24292e","--shiki-dark":"#abb2bf","--shiki-light-bg":"#fff","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes github-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"scoop"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," mysql")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"})])],-1),F=s("p",null,[i("然后在 "),s("code",null,"services.msc"),i(" 里启动 MySQL 服务，报错："),s("em",null,"本地计算机上的 MySQL 服务启动后停止。某些服务在未由其他服务或程序使用时将自动停止。")],-1),E=s("p",null,[i("根据"),s("a",{href:"https://www.cnblogs.com/zhengdaojie/p/17374473.html",target:"_blank",rel:"noopener noreferrer"},"此博客"),i("内容，解决问题。")],-1),v=l(`<p>进去以后重置下密码：<code>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;password&#39;;</code>。</p><h3 id="基础" tabindex="-1"><a class="header-anchor" href="#基础"><span>基础</span></a></h3><ul><li><code>&lt;C-d&gt;</code> = 退出</li><li>查看 sql 历史指令：<code>less ~/.mysql_history</code></li></ul><h3 id="备份与恢复" tabindex="-1"><a class="header-anchor" href="#备份与恢复"><span>备份与恢复</span></a></h3><p>mysqldump 是热备份，即无需关闭 mysql 服务。</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 备份</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysqldump</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">database</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bak-time.sql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -avz</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">sshnam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">file_pat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">destination_pat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 恢复（Linux only）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> database</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">database_nam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">user_nam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">database</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">dumpfil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 恢复（任意系统）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">user_nam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">             # 进入 mysql 环境</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> database</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">database_nam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">database_nam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;                </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 必须先 use 数据库</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">source</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">dumpfil</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="用户管理" tabindex="-1"><a class="header-anchor" href="#用户管理"><span>用户管理</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">sudo mysql</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> USER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">new_user</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&#39;@</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;localhost&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;password&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> . </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;new_user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;localhost&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">FLUSH PRIVILEGES;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">\\q</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"># </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">then</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> login</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">mysql </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">u </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">user_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">p</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mariadb" tabindex="-1"><a class="header-anchor" href="#mariadb"><span>MariaDB</span></a></h2><p>MariaDB replaces mysql (( (<a href="https://archlinux.org/news/mariadb-replaces-mysql-in-repositories/" target="_blank" rel="noopener noreferrer">src</a>)</p><p>安装问题可以看看 <a href="#%E5%AE%89%E8%A3%85-mariadb">安装 MariaDB</a>。</p><p>安装后，可以将 mysql 看成 mariadb 的 alias。有的 mysql 指令直接用会报 deprecate warning，无所 x 谓。</p><blockquote><p>我原以为 mariadb 这么高的兼容度完全可以直接用，没想到被 django 打脸。<br> 真的吗？</p></blockquote><h3 id="从-mysql-导入" tabindex="-1"><a class="header-anchor" href="#从-mysql-导入"><span>从 mysql 导入</span></a></h3><p>首先<a href="#%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D">获取到 mysql 的 dumpfile</a>，尝试直接恢复报错：<code>Unknown collation: &#39;utf8mb4_0900_ai_ci&#39;</code>。</p><p>于是直接 <code>sed -i &#39;s/utf8mb4_0900_ai_ci/uca1400_as_ci/g&#39; test.sql</code> 再导入，问题解决。(<a href="https://dba.stackexchange.com/a/314442" target="_blank" rel="noopener noreferrer">ref</a>)</p><h2 id="postgresql" tabindex="-1"><a class="header-anchor" href="#postgresql"><span>PostgreSQL</span></a></h2><p>我看到了很多 pgsql 吹（<a href="#external">external 2.3.</a>），被吹得有点心动。日后可能会尝试。</p><h2 id="遇到的问题" tabindex="-1"><a class="header-anchor" href="#遇到的问题"><span>遇到的问题</span></a></h2><h3 id="安装-mysql" tabindex="-1"><a class="header-anchor" href="#安装-mysql"><span>安装 Mysql</span></a></h3><p>init 阶段获取到了一个默认密码。<a href="#%E5%AE%89%E8%A3%85">安装</a>后直接 <code>sudo mysqld</code>，提示：</p><blockquote><p>2023-10-21T10:21:00.659995Z 0 [ERROR] [MY-010123] [Server] Fatal error: Please read &quot;Security&quot; section of the manual to find out how to run mysqld as root!<br> 2023-10-21T10:21:00.660021Z 0 [ERROR] [MY-010119] [Server] Aborting<br> 2023-10-21T10:21:00.660109Z 0 [System] [MY-010910] [Server] /usr/bin/mysqld: Shutdown complete (mysqld 8.0.34) Source distribution.</p></blockquote><p><code>sudo mysqladmin -u root -p login</code>：<em>error: &#39;Your password has expired. To log in you must change it using a client that supports expired passwords.&#39;</em></p><p>加上了 <code>--skip-password</code> 后，<em>error: &#39;Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: NO)&#39;</em> 仍然不行。</p><p>吃了个晚饭，清空了下脑子的缓存，然后直接 <code>mysql -u root -p</code> 输入默认密码就好了。。这是我没想到的。</p><p>进去以后重置下密码。</p><h3 id="安装-mariadb" tabindex="-1"><a class="header-anchor" href="#安装-mariadb"><span>安装 MariaDB</span></a></h3><p>被 mysql 的初始化折磨了好久（<s>结果发现这位一样折磨</s>）。在 archlinux 上折腾 mysql 久无果，得知 <a href="#mariadb">mariadb</a> 兼容 mysql，因此换用之：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pacman</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -Rs</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pacman</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -S</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mariadb</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libmariadbclient</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mariadb-clients</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后直接 <code>mariadb</code> 报：<em>Can&#39;t connect to local server through socket &#39;/run/mysqld/mysqld.sock&#39; (2) when trying to connect</em></p><p>没有启动服务，启动之：<code>sudo systemctl start mariadb</code>，报：</p><blockquote><p>Job for mariadb.service failed because the control process exited with error code.<br> See &quot;systemctl status mariadb.service&quot; and &quot;journalctl -xeu mariadb.service&quot; for details.</p></blockquote><p><code>sudo journalctl -u mariadb.service</code>，log 显示</p><blockquote><p>[ERROR] Plugin &#39;InnoDB&#39; registration as a STORAGE ENGINE failed.<br> [Note] Plugin &#39;wsrep-provider&#39; is disabled.<br> [ERROR] Could not open mysql.plugin table: &quot;Table &#39;mysql.plugin&#39; doesn&#39;t exist&quot;. Some plugins may be not loaded<br> [ERROR] Unknown/unsupported storage engine: InnoDB<br> [ERROR] Aborting<br> mariadb.service: Main process exited, code=exited, status=1/FAILURE<br> mariadb.service: Failed with result &#39;exit-code&#39;.<br> Failed to start MariaDB 11.1.2 database server.</p></blockquote><p>麻了，尝试 <code>sudo mysql_install_db --user=mysql --ldata=/var/lib/mysql/</code>，一样报错。提示 <code>/usr/bin/mysql_install_db --defaults-file=~/.my.cnf</code>，结果根本没有 <code>~/.my.cnf</code>。</p><p>漫长的试错，最后：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /var/lib/mysql/</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysql_install_db</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --user=mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --ldata=/var/lib/mysql/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>才解决。感觉像是从 mysql 换到 mariadb 没有删 <code>/var/lib/mysql/</code> ，不兼容导致的。</p><h2 id="external" tabindex="-1"><a class="header-anchor" href="#external"><span>external</span></a></h2><ol><li><a href="https://aws.amazon.com/cn/compare/the-difference-between-mysql-vs-postgresql" target="_blank" rel="noopener noreferrer">MySQL 和 PostgreSQL 有何区别？</a></li><li><a href="https://gist.github.com/cpursley/c8fb81fe8a7e5df038158bdfe0f06dbb" target="_blank" rel="noopener noreferrer">PostgreSQL is Enough</a></li><li><a href="https://sive.rs/pg" target="_blank" rel="noopener noreferrer">Simplify: move code into database functions</a></li><li><a href="https://thiscute.world/posts/consistency-and-consensus-algorithm/" target="_blank" rel="noopener noreferrer">分布式数据库的一致性问题与共识算法</a></li><li><a href="https://pigsty.cc/zh/blog/db/mysql-is-dead/" target="_blank" rel="noopener noreferrer">MySQL 已死，PostgreSQL 当立</a></li><li><a href="https://prql-lang.org/" target="_blank" rel="noopener noreferrer">PRQL (Pipelined Relational Query Language) is a modern language for transforming data</a></li></ol><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p>MariaDB 是 MySQL 的分支，完全开源，而 MySQL 是商业产品，部分开源。(<a href="https://aws.amazon.com/cn/compare/the-difference-between-mariadb-vs-mysql/" target="_blank" rel="noopener noreferrer">ref</a>) <a href="#footnote-ref1" class="footnote-backref">↩︎</a></p></li><li id="footnote2" class="footnote-item"><p><s>MySQL 已死：</s> <em>开源界一般用 mariadb，IT 公司一般用 percona-server。</em> ——<a href="https://blog.lilydjwg.me" target="_blank" rel="noopener noreferrer">依云</a> <a href="#footnote-ref2" class="footnote-backref">↩︎</a></p></li></ol></section>`,42);function f(q,_){const h=k("RouteLink"),p=k("Tabs");return d(),o("div",null,[g,s("ul",null,[s("li",null,[i("Windows: use "),t(h,{to:"/farraginous/recommend_packages.html#scoop"},{default:a(()=>[i("scoop")]),_:1}),i(". "),y])]),B,s("p",null,[i("随便找个 "),t(h,{to:"/farraginous/recommend_websites.html#ai-%E5%B7%A5%E5%85%B7"},{default:a(()=>[i("gpt")]),_:1}),i(" 写吧。我目前看到有 rusqlite 和 sqlx 两套库可以选择。")]),u,t(p,{id:"437",data:[{id:"Linux"},{id:"Windows"}]},{title0:a(({value:e,isActive:n})=>[i("Linux")]),title1:a(({value:e,isActive:n})=>[i("Windows")]),tab0:a(({value:e,isActive:n})=>[A,m,b]),tab1:a(({value:e,isActive:n})=>[D,C,F,E]),_:1}),v])}const S=r(c,[["render",f],["__file","sql.html.vue"]]),L=JSON.parse('{"path":"/coding/sql.html","title":"数据库","lang":"zh-CN","frontmatter":{"date":"2023-06-03T00:00:00.000Z","icon":"database","category":["编程"],"tag":["工具"],"description":"数据库 本人并没有深入学习数据库，日常都是简单的基础使用。因此事先声明，不要对此文抱有过高的期望。 数据库选择 大概分为关系型和非关系型，分布式和非分布式，嵌入和非嵌入，还有向量数据库等... 首先有一个很重要的概念，有跟随程序分发到客户端的文件数据库（嵌入式数据库），也有作为服务器端具有本地驱动的数据库。前者的关系型主要就是 SQLite，其他常见数...","head":[["meta",{"property":"og:url","content":"https://absx.pages.dev/coding/sql.html"}],["meta",{"property":"og:site_name","content":"绝对值_x 的博客"}],["meta",{"property":"og:title","content":"数据库"}],["meta",{"property":"og:description","content":"数据库 本人并没有深入学习数据库，日常都是简单的基础使用。因此事先声明，不要对此文抱有过高的期望。 数据库选择 大概分为关系型和非关系型，分布式和非分布式，嵌入和非嵌入，还有向量数据库等... 首先有一个很重要的概念，有跟随程序分发到客户端的文件数据库（嵌入式数据库），也有作为服务器端具有本地驱动的数据库。前者的关系型主要就是 SQLite，其他常见数..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-17T17:52:54.000Z"}],["meta",{"property":"article:tag","content":"工具"}],["meta",{"property":"article:published_time","content":"2023-06-03T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-17T17:52:54.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"数据库\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-06-03T00:00:00.000Z\\",\\"dateModified\\":\\"2025-01-17T17:52:54.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"数据库选择","slug":"数据库选择","link":"#数据库选择","children":[]},{"level":2,"title":"可视化工具","slug":"可视化工具","link":"#可视化工具","children":[]},{"level":2,"title":"SQL 语法基础","slug":"sql-语法基础","link":"#sql-语法基础","children":[{"level":3,"title":"学习路线","slug":"学习路线","link":"#学习路线","children":[]},{"level":3,"title":"引号","slug":"引号","link":"#引号","children":[]},{"level":3,"title":"基础语句","slug":"基础语句","link":"#基础语句","children":[]},{"level":3,"title":"多表查询","slug":"多表查询","link":"#多表查询","children":[]},{"level":3,"title":"集合操作","slug":"集合操作","link":"#集合操作","children":[]}]},{"level":2,"title":"SQLite","slug":"sqlite","link":"#sqlite","children":[{"level":3,"title":"注意事项","slug":"注意事项","link":"#注意事项","children":[]},{"level":3,"title":"压缩","slug":"压缩","link":"#压缩","children":[]},{"level":3,"title":"python","slug":"python","link":"#python","children":[]},{"level":3,"title":"rust","slug":"rust","link":"#rust","children":[]}]},{"level":2,"title":"duckdb","slug":"duckdb","link":"#duckdb","children":[]},{"level":2,"title":"Redis","slug":"redis","link":"#redis","children":[]},{"level":2,"title":"MySQL 基础","slug":"mysql-基础","link":"#mysql-基础","children":[{"level":3,"title":"常用数据类型","slug":"常用数据类型","link":"#常用数据类型","children":[]},{"level":3,"title":"基础改查","slug":"基础改查","link":"#基础改查","children":[]}]},{"level":2,"title":"MySQL 运维","slug":"mysql-运维","link":"#mysql-运维","children":[{"level":3,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":3,"title":"基础","slug":"基础","link":"#基础","children":[]},{"level":3,"title":"备份与恢复","slug":"备份与恢复","link":"#备份与恢复","children":[]},{"level":3,"title":"用户管理","slug":"用户管理","link":"#用户管理","children":[]}]},{"level":2,"title":"MariaDB","slug":"mariadb","link":"#mariadb","children":[{"level":3,"title":"从 mysql 导入","slug":"从-mysql-导入","link":"#从-mysql-导入","children":[]}]},{"level":2,"title":"PostgreSQL","slug":"postgresql","link":"#postgresql","children":[]},{"level":2,"title":"遇到的问题","slug":"遇到的问题","link":"#遇到的问题","children":[{"level":3,"title":"安装 Mysql","slug":"安装-mysql","link":"#安装-mysql","children":[]},{"level":3,"title":"安装 MariaDB","slug":"安装-mariadb","link":"#安装-mariadb","children":[]}]},{"level":2,"title":"external","slug":"external","link":"#external","children":[]}],"git":{"createdTime":1685809134000,"updatedTime":1737136374000,"contributors":[{"name":"lxl66566","email":"lxl66566@gmail.com","commits":16},{"name":"lxl66566","email":"18259734087@163.com","commits":14}]},"readingTime":{"minutes":9.81,"words":2942},"filePathRelative":"coding/sql.md","localizedDate":"2023年6月3日","excerpt":"\\n","autoDesc":true}');export{S as comp,L as data};
