<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.79" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"C++","image":[""],"datePublished":"2022-06-11T00:00:00.000Z","dateModified":"2025-05-26T16:52:58.000Z","author":[]}</script><meta property="og:url" content="https://absx.pages.dev/coding/Cpp.html"><meta property="og:site_name" content="绝对值_x 的博客"><meta property="og:title" content="C++"><meta property="og:description" content="C++ ——我从未懂过 C++ 一些工具 cppinsights：显式指明代码中的隐式转换与中间变量。 godbolt：汇编分析；pastebin；不同编译器的行为分析 Quick C++ Benchmark 常见名词 UB：Undefined behavior，未定义行为，典型的有 i = i++ + ++i，一个容易被忽视的 UB 是 a[i] =..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-05-26T16:52:58.000Z"><meta property="article:tag" content="编程语言"><meta property="article:published_time" content="2022-06-11T00:00:00.000Z"><meta property="article:modified_time" content="2025-05-26T16:52:58.000Z"><link rel="alternate" type="application/rss+xml" href="https://absx.pages.dev/rss.xml" title="绝对值_x 的博客 RSS Feed"><title>C++ | 绝对值_x 的博客</title><meta name="description" content="C++ ——我从未懂过 C++ 一些工具 cppinsights：显式指明代码中的隐式转换与中间变量。 godbolt：汇编分析；pastebin；不同编译器的行为分析 Quick C++ Benchmark 常见名词 UB：Undefined behavior，未定义行为，典型的有 i = i++ + ++i，一个容易被忽视的 UB 是 a[i] =...">
    <link rel="preload" href="/assets/style-B3BoCTQX.css" as="style"><link rel="stylesheet" href="/assets/style-B3BoCTQX.css">
    <link rel="modulepreload" href="/assets/app-B0ingTY3.js"><link rel="modulepreload" href="/assets/Cpp.html-CetyUxCV.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container external-link-icon pure has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="带我回家"><img class="vp-nav-logo" src="/logo.jpg" alt><!----><span class="vp-site-name hide-in-pad">绝对值_x 的博客</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/coding/" aria-label="编程" iconsizing="height"><!--[--><i class="vp-icon fas fa-code" sizing="height"></i><!--]-->编程<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="爱好"><!--[--><i class="vp-icon fas fa-heart" sizing="height"></i>爱好<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">游戏</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/hobbies/galgame.html" aria-label="galgame" iconsizing="both"><!--[--><i class="vp-icon fas fa-plane fa-fw" sizing="both"></i><!--]-->galgame<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/hobbies/rhythm_games.html" aria-label="音游" iconsizing="both"><!--[--><i class="vp-icon fas fa-keyboard fa-fw" sizing="both"></i><!--]-->音游<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/hobbies/Minecraft.html" aria-label="我的世界" iconsizing="both"><!--[--><i class="vp-icon fas fa-tree fa-fw" sizing="both"></i><!--]-->我的世界<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/hobbies/other_games/" aria-label="其他游戏" iconsizing="both"><!--[--><i class="vp-icon fas fa-gamepad fa-fw" sizing="both"></i><!--]-->其他游戏<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">艺术</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/hobbies/books.html" aria-label="读书" iconsizing="both"><!--[--><i class="vp-icon fas fa-book-open-reader fa-fw" sizing="both"></i><!--]-->读书<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/hobbies/anime.html" aria-label="番剧" iconsizing="both"><!--[--><i class="vp-icon fas fa-play fa-fw" sizing="both"></i><!--]-->番剧<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/hobbies/art.html" aria-label="其他艺术形式" iconsizing="both"><!--[--><i class="vp-icon fas fa-palette fa-fw" sizing="both"></i><!--]-->其他艺术形式<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/hobbies/NSFW/" aria-label="NSFW" iconsizing="both"><!--[--><i class="vp-icon fas fa-h fa-fw" sizing="both"></i><!--]-->NSFW<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">其他</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/hobbies/snack.html" aria-label="零食区" iconsizing="both"><!--[--><i class="vp-icon fas fa-cookie-bite fa-fw" sizing="both"></i><!--]-->零食区<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="杂项"><!--[--><i class="vp-icon fas fa-plus" sizing="height"></i>杂项<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/farraginous/recommend_packages.html" aria-label="软件汇总" iconsizing="both"><!--[--><i class="vp-icon fas fa-cube fa-fw" sizing="both"></i><!--]-->软件汇总<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/farraginous/recommend_websites.html" aria-label="网址汇总" iconsizing="both"><!--[--><i class="vp-icon fas fa-earth-asia fa-fw" sizing="both"></i><!--]-->网址汇总<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/farraginous/college.html" aria-label="校内专栏" iconsizing="both"><!--[--><i class="vp-icon fas fa-graduation-cap fa-fw" sizing="both"></i><!--]-->校内专栏<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/farraginous/reciter.html" aria-label="背词器" iconsizing="both"><!--[--><i class="vp-icon fas fa-eye fa-fw" sizing="both"></i><!--]-->背词器<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/articles/" aria-label="文章" iconsizing="height"><!--[--><i class="vp-icon fas fa-blog" sizing="height"></i><!--]-->文章<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/learning/" aria-label="学习" iconsizing="height"><!--[--><i class="vp-icon fas fa-pen" sizing="height"></i><!--]-->学习<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/gossip/" aria-label="闲聊" iconsizing="height"><!--[--><i class="vp-icon fas fa-comment" sizing="height"></i><!--]-->闲聊<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/essay/" aria-label="随笔" iconsizing="height"><!--[--><i class="vp-icon fas fa-newspaper" sizing="height"></i><!--]-->随笔<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/" aria-label="博客" iconsizing="height"><!--[--><i class="vp-icon fas fa-blog" sizing="height"></i><!--]-->博客<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/lxl66566/lxl66566.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item vp-action"><a class="vp-action-link" href="https://t.me/ab5_x" target="_blank" rel="noopener noreferrer" aria-label="telegram"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z" fill="currentColor"></path></svg></a></div><div class="nav-item vp-action"><a class="vp-action-link" href="/rss.xml" target="_blank" rel="noopener noreferrer" aria-label="telegram"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M320.16155 831.918c0 70.738-57.344 128.082-128.082 128.082S63.99955 902.656 63.99955 831.918s57.344-128.082 128.082-128.082 128.08 57.346 128.08 128.082z m351.32 94.5c-16.708-309.2-264.37-557.174-573.9-573.9C79.31155 351.53 63.99955 366.21 63.99955 384.506v96.138c0 16.83 12.98 30.944 29.774 32.036 223.664 14.568 402.946 193.404 417.544 417.544 1.094 16.794 15.208 29.774 32.036 29.774h96.138c18.298 0.002 32.978-15.31 31.99-33.58z m288.498 0.576C943.19155 459.354 566.92955 80.89 97.00555 64.02 78.94555 63.372 63.99955 77.962 63.99955 96.032v96.136c0 17.25 13.67 31.29 30.906 31.998 382.358 15.678 689.254 322.632 704.93 704.93 0.706 17.236 14.746 30.906 31.998 30.906h96.136c18.068-0.002 32.658-14.948 32.01-33.008z" fill="currentColor"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="slimsearch-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="slimsearch-placeholder">搜索</div><div class="slimsearch-key-hints"><kbd class="slimsearch-key">Ctrl</kbd><kbd class="slimsearch-key">K</kbd></div></button><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><!----><span class="vp-sidebar-title">思考</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/coding/philosophy_of_PL.html" aria-label="编程语言哲学胡言乱语" iconsizing="both"><!--[--><i class="vp-icon fas fa-question fa-fw" sizing="both"></i><!--]-->编程语言哲学胡言乱语<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><!----><span class="vp-sidebar-title">语言</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/coding/Rust.html" aria-label="Rust" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-rust fa-fw" sizing="both"></i><!--]-->Rust<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/python.html" aria-label="Python" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-python fa-fw" sizing="both"></i><!--]-->Python<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/coding/Cpp.html" aria-label="C++" iconsizing="both"><!--[--><i class="vp-icon fas fa-code fa-fw" sizing="both"></i><!--]-->C++<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/shell.html" aria-label="shell script" iconsizing="both"><!--[--><i class="vp-icon fas fa-fish fa-fw" sizing="both"></i><!--]-->shell script<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/java.html" aria-label="Java" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-java fa-fw" sizing="both"></i><!--]-->Java<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/tsjs.html" aria-label="TypeScript" iconsizing="both"><!--[--><i class="vp-icon fas fa-code fa-fw" sizing="both"></i><!--]-->TypeScript<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/html.html" aria-label="html" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-html5 fa-fw" sizing="both"></i><!--]-->html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/csharp.html" aria-label="C#" iconsizing="both"><!--[--><i class="vp-icon fas fa-code fa-fw" sizing="both"></i><!--]-->C#<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/kotlin.html" aria-label="kotlin" iconsizing="both"><!--[--><i class="vp-icon fas fa-code fa-fw" sizing="both"></i><!--]-->kotlin<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/clojure.html" aria-label="Clojure" iconsizing="both"><!--[--><i class="vp-icon fas fa-code fa-fw" sizing="both"></i><!--]-->Clojure<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><!----><span class="vp-sidebar-title">工具</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/coding/github.html" aria-label="Github" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-github fa-fw" sizing="both"></i><!--]-->Github<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/Git.html" aria-label="Git" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-git-alt fa-fw" sizing="both"></i><!--]-->Git<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/vscode.html" aria-label="VSCode" iconsizing="both"><!--[--><i class="vp-icon fas fa-file-pen fa-fw" sizing="both"></i><!--]-->VSCode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/vim.html" aria-label="vim" iconsizing="both"><!--[--><i class="vp-icon fas fa-keyboard fa-fw" sizing="both"></i><!--]-->vim<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/sql.html" aria-label="数据库" iconsizing="both"><!--[--><i class="vp-icon fas fa-database fa-fw" sizing="both"></i><!--]-->数据库<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/container.html" aria-label="容器" iconsizing="both"><!--[--><i class="vp-icon fas fa-box fa-fw" sizing="both"></i><!--]-->容器<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/package_manager.html" aria-label="包管理器" iconsizing="both"><!--[--><i class="vp-icon fas fa-cubes fa-fw" sizing="both"></i><!--]-->包管理器<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><!----><span class="vp-sidebar-title">前端</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/coding/nodejs.html" aria-label="JS 运行时" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-node-js fa-fw" sizing="both"></i><!--]-->JS 运行时<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/tsjs.html" aria-label="TypeScript" iconsizing="both"><!--[--><i class="vp-icon fas fa-code fa-fw" sizing="both"></i><!--]-->TypeScript<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/css.html" aria-label="CSS" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-css fa-fw" sizing="both"></i><!--]-->CSS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/html.html" aria-label="html" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-html5 fa-fw" sizing="both"></i><!--]-->html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/vue.html" aria-label="Vue.js" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-vuejs fa-fw" sizing="both"></i><!--]-->Vue.js<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/react.html" aria-label="React" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-react fa-fw" sizing="both"></i><!--]-->React<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/solidjs.html" aria-label="SolidJS" iconsizing="both"><!--[--><i class="vp-icon fas fa-arrow-up-right-dots fa-fw" sizing="both"></i><!--]-->SolidJS<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><!----><span class="vp-sidebar-title">其他</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/coding/bagu.html" aria-label="八股" iconsizing="both"><!--[--><i class="vp-icon fas fa-book-skull fa-fw" sizing="both"></i><!--]-->八股<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/android.html" aria-label="Android" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-android fa-fw" sizing="both"></i><!--]-->Android<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/algorithm.html" aria-label="算法" iconsizing="both"><!--[--><i class="vp-icon fas fa-wand-sparkles fa-fw" sizing="both"></i><!--]-->算法<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/bot.html" aria-label="bot" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-bots fa-fw" sizing="both"></i><!--]-->bot<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/coding/octave.html" aria-label="Matlab/Octave" iconsizing="both"><!--[--><i class="vp-icon fas fa-brands fa-octopus-deploy fa-fw" sizing="both"></i><!--]-->Matlab/Octave<!----></a></li></ul></section></li></ul><!----></aside><!--[--><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon fas fa-code" sizing="height"></i>C++</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="写作日期"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2022年6月11日</span><meta property="datePublished" content="2022-06-11T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 19 分钟</span><meta property="timeRequired" content="PT19M"></span><span class="page-category-info" aria-label="分类"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item clickable" role="navigation">编程</span><span class="page-category-item clickable" role="navigation">经历</span><!--]--><meta property="articleSection" content="编程,经历"></span><span class="page-tag-info" aria-label="标签"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item clickable" role="navigation">编程语言</span><!--]--><meta property="keywords" content="编程语言"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="c" tabindex="-1"><a class="header-anchor" href="#c"><span>C++</span></a></h1><div class="subtitle">——我从未懂过 C++</div><h2 id="一些工具" tabindex="-1"><a class="header-anchor" href="#一些工具"><span>一些工具</span></a></h2><ul><li><a href="https://cppinsights.io/" target="_blank" rel="noopener noreferrer">cppinsights</a>：显式指明代码中的隐式转换与中间变量。</li><li><a href="https://godbolt.org/" target="_blank" rel="noopener noreferrer">godbolt</a>：汇编分析；pastebin；不同编译器的行为分析</li><li><a href="https://quick-bench.com/" target="_blank" rel="noopener noreferrer">Quick C++ Benchmark</a></li></ul><h2 id="常见名词" tabindex="-1"><a class="header-anchor" href="#常见名词"><span>常见名词</span></a></h2><ul><li>UB：Undefined behavior，未定义行为，典型的有 <code>i = i++ + ++i</code>，一个容易被忽视的 UB 是 <code>a[i] = i++;</code>。(<a href="https://en.cppreference.com/w/c/language/eval_order" target="_blank" rel="noopener noreferrer">ref</a>)</li></ul><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><p>C++ 开发前的准备挺复杂的，做好心理准备。</p><p>linux 下用包管理器，配置环境应该是基础技能。这里写的主要是 windows 下的开发步骤。</p><p>我目前正在使用 <em>xmake + clang 全套</em> 进行开发。</p><h3 id="编译器" tabindex="-1"><a class="header-anchor" href="#编译器"><span>编译器</span></a></h3><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="tab-49-0" aria-selected="true">clang</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-49-1" aria-selected="false">mingw</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-49-2" aria-selected="false">msvc</button></div><!--[--><div class="vp-tab active" id="tab-49-0" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">clang</div><!--[--><blockquote><p>Clang 是 LLVM 的前端，具有速度快、内存占用小、诊断信息可读性强、兼容性好等优势。<a href="https://www.51cto.com/article/630677.html" target="_blank" rel="noopener noreferrer">ref</a></p></blockquote><p><a class="route-link" href="/farraginous/recommend_packages.html#scoop">scoop</a> 一行：<code>scoop install llvm</code>。</p><p>安装 llvm 还会附带 clang 前端工具如 <em>clangd</em>, <em>clang-tidy</em>, <em>clang-format</em>。</p><p>注：llvm 本体貌似不带运行库，可以考虑 <code>scoop install mingw-winlibs-llvm</code>。</p><!--]--></div><div class="vp-tab" id="tab-49-1" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">mingw</div><!--[--><p>windows 上不想装 msvc 的话可以考虑使用 mingw。</p><p><a class="route-link" href="/farraginous/recommend_packages.html#scoop">scoop</a> 一行：<code>scoop install mingw</code>。</p><!--]--></div><div class="vp-tab" id="tab-49-2" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">msvc</div><!--[--><p><a href="https://learn.microsoft.com/zh-cn/visualstudio/install/install-visual-studio" target="_blank" rel="noopener noreferrer">安装 visual studio</a>（体积较大）。</p><!--]--></div><!--]--></div><h3 id="开发环境" tabindex="-1"><a class="header-anchor" href="#开发环境"><span>开发环境</span></a></h3><p>我使用 <a class="route-link" href="/coding/vscode.html">VSCode</a> 作为 C++ 代码编辑器。以下扩展都可以直接在 vscode 商店搜到；只需选择一个即可。</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="tab-86-0" aria-selected="true">Clang-Tidy + Clang-Format</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-86-1" aria-selected="false">clangd</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-86-2" aria-selected="false">Microsoft C/C++</button></div><!--[--><div class="vp-tab active" id="tab-86-0" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">Clang-Tidy + Clang-Format</div><!--[--><blockquote><p>Clang-Tidy 比 clangd 要<strong>慢很多</strong>（功能也更多）。并且 <a href="https://discourse.llvm.org/t/list-of-clang-tidy-checks-supported-in-clangd/61013" target="_blank" rel="noopener noreferrer">clangd 尊重 clang-tidy 的设置</a>，因此非解耦需求下还是用 clangd 比较好。</p></blockquote><p>为什么选这个组合呢，因为解耦：我不喜欢让一个扩展完成所有任务，我希望 linter 和 formatter 分离<sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup>，这样是自由度最高的方案。</p><p>Clang-Tidy 在 vscode 扩展里的名字叫 <em>CS 128 Clang-Tidy</em>。</p><!--]--></div><div class="vp-tab" id="tab-86-1" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">clangd</div><!--[--><p>调用外部的 linter + formatter，非常快速。</p><p>前置条件：安装 <a href="#%E7%BC%96%E8%AF%91%E5%99%A8">clang 全套</a>工具。主要是 linter <code>clangd</code> 和 formatter <code>clang-format</code>。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>相比 <em>C/C++</em> 扩展的 LSP，clangd 具有其他优点：</p><ol><li>响应速度快。用过 <em>Microsoft C/C++</em> 扩展的人都知道其慢的一批。</li><li><em>clang-format</em> 格式化功能强大，高度自定义化。</li><li>支持 inlay hints</li></ol></div><p>可能需要自己填一个 <code>clang-format.exe</code> 的位置，去 llvm 安装位置找，或者用 <a class="route-link" href="/farraginous/recommend_packages.html#everything">everything</a> 搜一下。</p><ul><li><code>clang-format.exe -style=llvm -dump-config &gt; .clang-format</code> 可以导出设置，一般不需要。</li></ul><!--]--></div><div class="vp-tab" id="tab-86-2" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">Microsoft C/C++</div><!--[--><p>all in one 类型的插件，我<strong>不是很喜欢，不够自由</strong>。</p><div class="hint-container tip"><p class="hint-container-title">不过还是说几句好话</p><ul><li>快速上手，对新人友好。</li><li>无需了解<a href="#%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F">构建系统</a>，可以直接点右上角 <em>运行</em> 按钮快速运行<strong>单文件</strong>。</li><li>可视化 debug。</li></ul></div><ol><li>在工作区<strong>打开一个文件夹</strong>，新建一个简单的 helloworld.cpp 文件（内容请自己写完）。</li><li><code>Ctrl + Shift + P</code> 打开命令面板。 <ol><li>搜索并点击 <code>C/C++: Edit Configurations (UI)</code> ，将编译器路径改为编译器的 <code>g++.exe</code>；在 <em>IntelliSense 模式</em> 下选择相应的工具链，例如 mingw 选择 <code>gcc-x64</code>。此时 vscode 会自动在工作区创建 <code>.vscode</code> 存放配置。</li><li>搜索并点击 <code>Tasks: Configure Default Build Task</code>，再选择 <code>C/C++: g++.exe build active file</code>。</li></ol></li></ol><!--]--></div><!--]--></div><h3 id="构建系统" tabindex="-1"><a class="header-anchor" href="#构建系统"><span>构建系统</span></a></h3><p>最广泛使用的是用 <em>Cmake</em>，然而我并不喜欢它。网上也有一些类似的想法：<a href="https://twdev.blog/2021/08/cmake/" target="_blank" rel="noopener noreferrer">Why CMake sucks?</a>。</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="tab-195-0" aria-selected="true">xmake</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-195-1" aria-selected="false">cmake</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-195-2" aria-selected="false">cmkr</button></div><!--[--><div class="vp-tab active" id="tab-195-0" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">xmake</div><!--[--><p>xmake 是向下兼容 cmake 的构建工具，拥有极度简洁的语法。xmake 使用 lua 脚本作为构建系统语言。<strong><s>我真的不想再面对一团乱麻的 cmake 了！</s></strong></p><ul><li><a href="https://zhuanlan.zhihu.com/p/640701847" target="_blank" rel="noopener noreferrer">新手教程</a>，由于我自己摸索而不是看教程，多走了许多弯路。因此推荐看看。</li><li>开始使用： <ul><li>use <a class="route-link" href="/farraginous/recommend_packages.html#scoop">scoop</a>, <code>scoop install xmake</code> 一行安装。输入 <code>xmake -h</code> 了解更多。</li><li>示例：<code>xmake create -l c++ -P ./cpp &amp;&amp; cd cpp &amp;&amp; xmake &amp;&amp; xmake r</code></li><li>一些 LSP 可能会需要 <code>compile_commands.json</code>：<code>xmake project -k compile_commands</code></li></ul></li><li>一些预设<div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_encodings</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;utf-8&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)            </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 没加会导致 Qt 中文乱码</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_policy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;build.warning&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 开启编译警告</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_languages</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cxxlatest&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)        </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 设置 C++ 版本</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_optimize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fastest&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)           </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 优化等级，不过 release 有默认</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add_requires</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fmt&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">target</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  -- ...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  add_packages</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fmt&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 添加 fmt 包</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>查找包（任选）： <ul><li>手动去 <a href="https://github.com/xmake-io/xmake-repo/" target="_blank" rel="noopener noreferrer">xmake-repo</a> 找</li><li>命令行：<code>xrepo search &lt;package_name&gt;...</code>，可用 <code>*</code> 作为通配符</li><li><a href="https://xmake.microblock.cc/" target="_blank" rel="noopener noreferrer">microblock 群友做的第三方网页</a></li></ul></li><li>指定工具链 <ul><li>在 target 中添加 <code>set_toolchains(&quot;clang&quot;)</code></li></ul></li></ul><p>xmake 的主要缺点就是用的人少，出了 bug 找不到解决方案。不过由于我的个人项目简单，我姑且还是用着 xmake 的。</p><!--]--></div><div class="vp-tab" id="tab-195-1" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">cmake</div><!--[--><p>cmake 内部原理是生成 makefile 然后再 make。</p><p>实际上我也就写 Qt 接触了一下 cmake，后面很快转到 xmake 了，关于 cmake 的了解不算多。</p><ul><li>安装：<code>scoop install cmake</code>，或者 VS 安装里也有，不过要自己加 PATH。</li></ul><!--]--></div><div class="vp-tab" id="tab-195-2" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">cmkr</div><!--[--><p><a href="https://github.com/build-cpp/cmkr" target="_blank" rel="noopener noreferrer">cmkr</a>，基于 toml 生成 cmake 文件，三阶构建（cmkr -&gt; cmakelists -&gt; makefile）</p><!--]--></div><!--]--></div><h3 id="包管理" tabindex="-1"><a class="header-anchor" href="#包管理"><span>包管理</span></a></h3><h4 id="windows" tabindex="-1"><a class="header-anchor" href="#windows"><span>windows</span></a></h4><p>虽然有的构建系统（例如 xmake）有 xrepo 帮你解决了包管理问题，但是大部分项目仍然需要使用专门的包管理器管理依赖，更有甚者需要手动摸索依赖。vcpkg 是 windows msvc 体系里最常用的包管理器。你甚至可以在各种 rust 库里看到要求使用 vcpkg 安装的依赖，例如 libarchive。</p><p>vcpkg <a href="https://learn.microsoft.com/zh-cn/vcpkg/concepts/classic-mode" target="_blank" rel="noopener noreferrer">有两个工作模式</a>，<em>经典模式</em> 和 <em>清单模式</em>，其实就是 global 和 per-project 的区别。如果你使用的是 Visual Studio 自带的 vcpkg，其默认运行在 <em>清单模式</em>；但是很多时候（比如上述的 rust 编译需要调用 vcpkg）时，直接用 <code>vcpkg install xxx</code> 会<a href="https://learn.microsoft.com/zh-cn/vcpkg/troubleshoot/build-failures?WT.mc_id=vcpkg_inproduct_cli#cannot-install-packages-using-classic-mode" target="_blank" rel="noopener noreferrer">报错 <em>Could not locate a manifest</em></a>，我们更需要 <em>经典模式</em> 的全局包，因此用 scoop 再 install 一个独立的 vcpkg 是很有必要的。</p><h4 id="linux" tabindex="-1"><a class="header-anchor" href="#linux"><span>linux</span></a></h4><p>linux 上各种包一般依赖于系统包管理器与 pkgconfig 的 .pc 文件。系统包安装后自带了一个 .pc 文件用于指示包的位置、版本、依赖等信息。构建系统会通过 pkg-config 命令读取这些 .pc 文件来获取编译所需的信息。</p><h3 id="qt-开发环境" tabindex="-1"><a class="header-anchor" href="#qt-开发环境"><span>Qt 开发环境</span></a></h3><p>Qt 是一个 C++ 框架，主要是做 GUI 用的。<a href="#qt">查看介绍</a>。不用的话可以不装。</p><p>由于 Qt creater 没有 vscode 中的强大插件，因此我希望在 vscode 中开发 Qt 代码。</p><p>Qt 的构建（从 Qt6 开始）默认生成 cmake 配置，但也可以手写 xmake 配置。</p><h4 id="windows-1" tabindex="-1"><a class="header-anchor" href="#windows-1"><span>windows</span></a></h4><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="tab-327-0" aria-selected="true">xmake</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-327-1" aria-selected="false">cmake + C/C++ 扩展</button></div><!--[--><div class="vp-tab active" id="tab-327-0" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">xmake</div><!--[--><p>用 xmake 作为 Qt 的构建系统是一个不错的选择。之前曾经出现过<a class="route-link" href="/gossip/difficulties.html#20230507-qt6-%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E5%A4%B1%E8%B4%A5">一些问题</a>，但 20230802 再次尝试已经可以正常使用。</p><ol><li>使用 Qt Creator 创建模版项目。</li><li><code>xmake.lua</code> 参考<a href="https://xmake.io/#/zh-cn/guide/project_examples?id=widgets-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" target="_blank" rel="noopener noreferrer">官方文档</a>，这里是一个示例：<div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add_rules</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;mode.debug&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;mode.release&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">target</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;qt_widgetapp&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    add_rules</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;qt.widgetapp&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    add_files</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;src/*.cpp&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    add_files</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;src/mainwindow.ui&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    add_files</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;src/mainwindow.h&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>可能需要指定 sdk：<code>xmake f --qt=D:\software\QtSDK\6.6.0</code>（你的 Qt 安装路径）</li><li><a href="https://xmake.io/#/zh-cn/plugin/builtin_plugins?id=%E7%94%9F%E6%88%90compiler_commands" target="_blank" rel="noopener noreferrer">生成 compiler_commands.json</a>，使 clangd 能够读取 includePath 等。一行：<code>xmake project -k compile_commands</code></li><li><code>xmake &amp;&amp; xmake r</code> 就能跑了。</li></ol><p>刚做完 2. 的时候会出现经典问题，clangd 报 <em>找不到 <code>ui_mainwindow.h</code> 文件</em>… 因为它是编译期生成的。。用 cmake CLI 的时候可能需要麻烦手动生成，xmake 挺智能的，build 一次后就不会报错了，应该是 xmake 内置的 qt 规则起作用了。</p><p>需要注意，使用 xmake 构建的 Qt 程序无法在 stdout 输出字符，无论 release 还是 debug mode。（不知道是不是缺少了什么设置选项）</p><!--]--></div><div class="vp-tab" id="tab-327-1" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">cmake + C/C++ 扩展</div><!--[--><ol><li>先用 Qt creater 创建一个模板项目，或者打开现有项目，或者自己手写模板。</li><li><code>Ctrl + Shift + P</code>，键入<code>C/C++: Edit Configurations (UI)</code><ul><li>在 <em>包含路径</em> 下添加 <code>D:\software\Qt\6.5.0\mingw_64\include\**</code>（使用你自己的 include path）</li><li>将 <em>C++ 标准</em> 改为你需要的。（截至 Qt6.6.0 不支持 C++23）</li></ul></li><li>在项目目录下执行：<div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">uic</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mainwindow.ui</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ui_mainwindow.h</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rcc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> static.qrc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> static.cpp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    //</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 如果有</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> qrc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 文件则执行。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">//</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rcc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 不会读取</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> qresource</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> prefix，可能需要将</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .qrc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 文件拷贝到静态资源文件夹下并执行</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>将 <em>3.</em> 生成的文件（static.cpp） 添加至 <code>CMakelists.txt</code> 中的 <code>PROJECT_SOURCES</code></li><li>在 <code>CMakelists.txt</code> 中的 <code>find_package</code> 语句前添加：<div class="language-cmake" data-highlighter="shiki" data-ext="cmake" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">CMAKE_PREFIX_PATH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;D:/software/Qt/6.5.0/mingw_64&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)` </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># （使用你自己的 path）</span></span></code></pre></div></li></ol><!--]--></div><!--]--></div><h4 id="linux-1" tabindex="-1"><a class="header-anchor" href="#linux-1"><span>linux</span></a></h4><p>在 (arch)linux 上开发 qt 应用。</p><ol><li>通过 <a href="#%E5%AE%89%E8%A3%85">aqtinstall</a> 安装 sdk；通过 pacman 安装 <code>qt6-base</code>.</li><li>在 <code>xmake.lua</code> 中，新建 toolchains:<div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toolchain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;myqt&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    set_kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;standalone&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> is_os</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;linux&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        set_sdkdir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;~/program/qt/6.6.0/gcc_64/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 填写 sdk 目录</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        set_toolset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cxx&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;clang&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 指定编译器</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        add_linkdirs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/usr/lib/qt6/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>然后在 target 中 <code>set_toolchains(&quot;myqt&quot;)</code> 即可。</li></ol><h2 id="语言相关" tabindex="-1"><a class="header-anchor" href="#语言相关"><span>语言相关</span></a></h2><p><s>在大片的构建系统篇幅后我们终于走到了语言基础，太悲哀了。</s></p><h3 id="range-based-for-loop" tabindex="-1"><a class="header-anchor" href="#range-based-for-loop"><span>range-based for loop</span></a></h3><blockquote><p>&gt;= C++11</p></blockquote><p>不用再写下标了。</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;"> &amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">i : vec){}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果需要同时使用下标，可以用 <a href="#ranges">ranges enumerate</a>（不过要 C++20）。</p><p>而且，range-based for loop 还有<a href="https://www.reddit.com/r/cpp/comments/pye3iv/c_committee_dont_want_to_fix_rangebased_for_loop/" target="_blank" rel="noopener noreferrer">生命周期问题</a>，10 年未修复。使用时应特别注意。</p><h3 id="数据结构" tabindex="-1"><a class="header-anchor" href="#数据结构"><span>数据结构</span></a></h3><ul><li><code>&lt;queue&gt;</code>： <ul><li>优先队列：<code>priority_queue&lt;T, vector&lt;T&gt;, std::greater&lt;T&gt;&gt;</code><ul><li>自定义比较函数；重载类的 <code>&lt;</code> operator</li></ul></li></ul></li></ul><h3 id="值类型" tabindex="-1"><a class="header-anchor" href="#值类型"><span>值类型</span></a></h3><blockquote><p>&gt;= C++11</p></blockquote><p>C++11 引入了更多的值类型，这其实也是所有权的体现。在左值和右值中间添加了 xvalue（将亡值），也就是带有所有权的右值（右值引用）<span title="你知道的太多了" data-v-3735ce50><!--[-->（名词真的好多！）<!--]--></span>至于其他的 glvalue, prvalue 都是集合的相加相减，没啥意思。总之只要知道 xvalue 是啥就行。</p><p>std::move() 可以将值转换为 xvalue，实际上相当于 <code>static_cast&lt;T &amp;&amp;&gt;()</code>。</p><h3 id="类型转换" tabindex="-1"><a class="header-anchor" href="#类型转换"><span>类型转换</span></a></h3><blockquote><p>&gt;= C++11</p></blockquote><ul><li><code>static_cast</code>：不进行安全检查</li><li><code>const_cast</code>：设置或移除指针/引用所指对象的 const</li><li><code>dynamic_cast</code>：进行安全检查，用于指针/引用转换，可以用于运行时父类转子类 <ul><li>有些情况下 <code>dynamic_cast</code> 的性能可以接近 <code>static_cast</code>。但大多数时候有额外开销。</li></ul></li><li><code>reinterpret_cast</code>：无视类型，进行最底层的比特位复制</li></ul><h3 id="智能指针" tabindex="-1"><a class="header-anchor" href="#智能指针"><span>智能指针</span></a></h3><blockquote><p>&gt;= C++11, &lt;memory&gt;</p></blockquote><ul><li><code>shared_ptr</code> 允许多个指针指向同一个对象，引用计数 <ul><li>(C++14) 使用 <code>std::make_shared&lt;Type&gt;()</code> 构建</li><li><code>reset()</code> 不带参数则释放（== release()）</li></ul></li><li><code>unique_ptr</code> 独占所指向的对象</li><li><code>weak_ptr</code> <em>shared_ptr</em> 的弱引用，不影响其计数器</li></ul><h3 id="多行字符串" tabindex="-1"><a class="header-anchor" href="#多行字符串"><span>多行字符串</span></a></h3><p>Raw string: <code>R&quot;&quot;(some\text)&quot;&quot;</code></p><h3 id="面向对象" tabindex="-1"><a class="header-anchor" href="#面向对象"><span>面向对象</span></a></h3><ul><li>构造函数：<div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MyClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> data;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 默认构造函数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    MyClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() : </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]) {}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 拷贝构造函数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    MyClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MyClass</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> other</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) : </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        std::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">copy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">other</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">other</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, data);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 移动构造函数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    MyClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MyClass</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;&amp;</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> other</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#ABB2BF;">noexcept</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">other</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        other</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nullptr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // 将资源置为空，避免释放时出错</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>protected：指能被子类访问，不能被外部访问的成员。</li><li>virtual：每个拥有虚对象的<strong>类本身</strong>都会有一个虚表，用来查询任何子类的某一特定重载。所以虚表对类是 static 的。 <ul><li>虚函数查找表发生在运行时。</li><li>调用虚函数所需的代价基本上和非虚函数效率一样，开销很小。</li><li>其他的可以看<a href="https://jacktang816.github.io/post/virtualfunction/" target="_blank" rel="noopener noreferrer">这篇文章</a>。</li></ul></li><li>C++ 允许多继承，菱形继承需要将中间类声明为虚类。（正常情况下不要使用菱形继承！）</li><li>非虚函数定义在类内自动内联。类外则需要显式 inline。</li><li>C++ 实现 interface：纯虚类，所有函数都是纯虚函数。</li><li>C++ 提倡继承代替组合。因为空类还会有 1byte 的空间，组合的话很亏。</li><li>私有继承不允许多态转换。</li></ul><h3 id="option" tabindex="-1"><a class="header-anchor" href="#option"><span>option</span></a></h3><p>(C++17) C++ 中有 <code>std::optional&lt;T&gt;</code> 起到类似 rust 中 Option 的作用。</p><ul><li>一些函数：<code>has_value() -&gt; bool</code>, <code>value() -&gt; T</code>, <code>value_or(T) -&gt; T</code></li></ul><h3 id="template" tabindex="-1"><a class="header-anchor" href="#template"><span>template</span></a></h3><p>前往 <a href="#external">external 1.</a>，讲得非常不错。</p><h3 id="内置模版比较函数" tabindex="-1"><a class="header-anchor" href="#内置模版比较函数"><span>内置模版比较函数</span></a></h3><p>算法竞赛常用的，例如优先队列会用到。签名是 class Compare。主要有：<code>std::greater</code>, <code>std::greater_equal</code>, <code>std::equal_to</code>, <code>std::not_equal_to</code>，再加上两个 greater 改成 less 的。</p><h3 id="variant" tabindex="-1"><a class="header-anchor" href="#variant"><span>variant</span></a></h3><p>（C++17）</p><p><a href="#external">external 14.</a> 是对 variant 的深度评测，推荐阅读。</p><p>variant 本意是封装的 <code>union</code>，可以当成错误处理的一种实现，类似 rust <code>Result</code>. C++23 请使用 <code>std::expected</code>.</p><p>获取值可以用 <code>std::get</code> + try catch，可以用 <code>std::get_if</code>，也可用 <a href="https://en.cppreference.com/w/cpp/utility/variant/visit" target="_blank" rel="noopener noreferrer"><code>std::visit</code></a>:</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">std::variant</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, string</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> v;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(v);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (std::bad_variant_access </span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(v);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 2</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pval </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get_if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">v))</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pval;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  std::cerr </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;failed to get value!&quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 3</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">std</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([](</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &amp;&amp;</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">arg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  using</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> T</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> std::</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">decay_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">decltype</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(arg)&gt;;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> constexpr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (std::is_same_v</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">T, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    std::cout </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;int with value &quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &lt;&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> arg </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> constexpr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (std::is_same_v</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">T, string</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    std::cout </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;errlog: &quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &lt;&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> arg </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="assert" tabindex="-1"><a class="header-anchor" href="#assert"><span>assert</span></a></h3><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static_assert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(a </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;error message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // compile time</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;cassert&gt;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">assert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(a </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;error message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // runtime</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至于 assert_eq 这种 std 就没有了，需要自己写宏或者引入 crpcut.hpp、GoogleTest 等框架。</p><h3 id="explicit" tabindex="-1"><a class="header-anchor" href="#explicit"><span>explicit</span></a></h3><p>explicit 可以防止隐式转换；修饰构造函数时，还可以防止复制初始化。rust 人非常喜欢这个东西。</p><h3 id="if-constexpr" tabindex="-1"><a class="header-anchor" href="#if-constexpr"><span>if constexpr</span></a></h3><p>编译期剪枝。可以用于类型判断。</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;type_traits&gt;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">template</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typename</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> T</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> constexpr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (std::is_same_v</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">T, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    static_assert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ranges" tabindex="-1"><a class="header-anchor" href="#ranges"><span>ranges</span></a></h3><blockquote><p>&gt;= C++20</p></blockquote><p>ranges 是 C++ 在函数式方面的努力，C++20 的四大特性之一。简单的说就是把各类操作变换 chain 在一起，简化写法，不再需要 <code>(c.begin(), c.end(), ...)</code>。</p><p>example 可以看 <a href="https://en.cppreference.com/w/cpp/ranges" target="_blank" rel="noopener noreferrer">cpp reference</a>。</p><ul><li><code>std::views</code> 和 <code>std::ranges::views</code> 是等价的。</li><li><code>std::ranges::for_each(Range, func)</code> 不能用 <code>|</code> chain，我不明白为什么要这么设计，有点脑残。</li><li><code>std::views::transform</code> 就是 map。</li><li>直到 C++23 都没有一个可 chain 的 reduce (<a href="https://en.cppreference.com/w/cpp/algorithm/ranges/fold_left" target="_blank" rel="noopener noreferrer">std<i class="vp-icon fas fa-ranges" sizing="height"></i>fold_left</a>)</li><li><code>std::views::zip</code> 和 <code>std::views::enumerate</code> 返回结果都是 tuple，要用 <code>std::get&lt;0&gt;(tuple)</code> 取值。</li><li>遍历 zip 时必须用 <code>auto</code>，不能用 <code>auto &amp;</code>：<div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [a, b] : std::</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">ranges</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">views</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">zip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(range_a, range_b)) {}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h2 id="volatile" tabindex="-1"><a class="header-anchor" href="#volatile"><span><a href="https://www.runoob.com/w3cnote/c-volatile-keyword.html" target="_blank" rel="noopener noreferrer">volatile</a></span></a></h2><p>表示某个变量可能随时变化，不要优化此变量的操作。</p><h2 id="程序计时" tabindex="-1"><a class="header-anchor" href="#程序计时"><span>程序计时</span></a></h2><p>程序计时可以用于分析代码效率。<a href="https://stackoverflow.com/questions/12883493/timing-the-execution-of-statements-c" target="_blank" rel="noopener noreferrer">代码参考</a> <span class="heimu" title="你知道的太多了">大佬能直接看汇编分析，但是太复杂还得 benchmark</span></p><h2 id="其他注意点" tabindex="-1"><a class="header-anchor" href="#其他注意点"><span>其他注意点</span></a></h2><ul><li>C++ 的错误处理并没有一个除 0 的标准错误，因此自己处理时需要 if 判断并 throw.</li><li>被 C++20 的 <code>std::ranges::remove_if()</code> 坑过（可能当时编译器实现有 bug(?)）</li><li>或许很难注意到的一些 <a href="#%E5%B8%B8%E8%A7%81%E5%90%8D%E8%AF%8D">UB</a>：有符号整数的溢出是 UB，控制流到达返回值不为 void 的函数的末尾，<s>还有一些操作裸指针的</s> <a href="https://zhuanlan.zhihu.com/p/391088391" target="_blank" rel="noopener noreferrer">source</a></li></ul><h2 id="qt" tabindex="-1"><a class="header-anchor" href="#qt"><span>Qt</span></a></h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>此处 Qt 部分版本代码为 Qt4-5，不保证能正常迁移至 Qt6;</p><p>以下内容并不是 Qt 基础的教程，缺乏目的性和针对性</p></div><h3 id="基本介绍-官网" tabindex="-1"><a class="header-anchor" href="#基本介绍-官网"><span>基本介绍 --&gt; <a href="https://www.qt.io/" target="_blank" rel="noopener noreferrer">官网</a></span></a></h3><p>Qt 是一个成熟的跨平台，<s>跨语言</s>的 GUI 框架（不建议再使用 MFC 等等了）。我用 C++ 做的最早的 GUI 应用就是用 Qt 写的。对于 C++ + GUI 需求，Qt 是比较简单快速的选择。</p><ul><li>它封装了很多窗口与控件类，可以轻松使用而并不需要深入了解其内部实现与原理 <em><s>（实际上它几乎封装了一切）</s></em></li><li>它支持可视化构建窗口界面 (Qt Designer)，极大幅度减小代码量</li><li><s>它提供的软件打包方式比较人性化</s>（有坑）</li></ul><h3 id="安装-1" tabindex="-1"><a class="header-anchor" href="#安装-1"><span>安装</span></a></h3><blockquote><p>推荐使用 CLI，快、用时短、空间占用小、无需登录</p></blockquote><ul><li>CLI: <a href="https://aqtinstall.readthedocs.io/en/latest/getting_started.html" target="_blank" rel="noopener noreferrer">aqtinstall</a><ol><li><code>scoop install aqtinstall</code></li><li><code>aqt install-qt --outputdir D:\software\QtSDK windows desktop 6.6.0 win64_msvc2019_64</code>（我的示例，别抄，去读文档；安装大小是 1.46G，已经很不错了）</li></ol></li><li>官方 GUI: <a href="https://www.qt.io/zh-cn/download" target="_blank" rel="noopener noreferrer">qt.io</a>。 <ul><li>需要在 msvc/mingw 中选择其一(?)。如果不想装重量级的 Visual Studio (提供 msvc)，你可以尝试安装 mingw 的 sdk，占用空间小点，不过配置会稍微麻烦一点。</li></ul></li></ul><h3 id="第三方" tabindex="-1"><a class="header-anchor" href="#第三方"><span>第三方</span></a></h3><p>一些可能会用到的第三方组件 / 框架。</p><ul><li><a href="https://github.com/ColinDuquesnoy/QDarkStyleSheet" target="_blank" rel="noopener noreferrer">QDarkStyleSheet</a>：窗口深色模式，参考<a href="#dark-mode">深色模式</a>。</li><li><a href="https://github.com/zhuzichu520/FluentUI" target="_blank" rel="noopener noreferrer">FluentUI</a>：提供一套 UI 框架。</li></ul><h3 id="dark-mode" tabindex="-1"><a class="header-anchor" href="#dark-mode"><span>dark mode</span></a></h3><p>深色模式支持是很重要的。</p><p>你可以很简单地<a href="https://forum.qt.io/topic/101391/windows-10-dark-theme/4" target="_blank" rel="noopener noreferrer">添加深色模式</a>（高对比度）；若你想使用更为柔和一点的颜色，可以使用第三方的<a href="https://github.com/ColinDuquesnoy/QDarkStyleSheet" target="_blank" rel="noopener noreferrer">QDarkStyleSheet</a>。</p><h3 id="唤起最小化的窗口" tabindex="-1"><a class="header-anchor" href="#唤起最小化的窗口"><span>唤起最小化的窗口</span></a></h3><div class="language-cpp" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">show</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">showNormal</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">raise</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">activateWindow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre></div><h3 id="关于控件组" tabindex="-1"><a class="header-anchor" href="#关于控件组"><span>关于控件组</span></a></h3><p>Qt 官方提供了 QButtonGroup 类。该类提供了对 QAbstractButton（即记忆化选择按钮）的分组。将按钮添加到 QButtonGroup 对象中，点击某一按钮时，组中其他按钮会被自动取消 toggle（已点击状态）。你也可以为组中每个按钮赋予数字 id，通过 id 对控件进行调用。</p><p>当然，QButtonGroup 类的使用范围是具有很大局限性的。若想对其他不同类型的控件新建分组该怎么做呢？</p><p>答：使用 <code>QVector&lt;QWidget*&gt;</code>。由于部分常用控件(QPushButton,QLable 等)继承自 QWidget，因此通过 QWidget 类型容器对组内控件进行统一操作，例如需要隐藏主窗口内的所有控件，只需 <code>for (auto &amp;i : elements) i-&gt;hide();</code> 即可。</p><p><em>对于 hide() 与 show() 操作来说，更简便的方法是将所有控件加入新的 widget，然后将该 widget 的父对象设为主窗口。之后的隐藏与显示只需对该 widget 操作即可。</em></p><h3 id="关于资源文件" tabindex="-1"><a class="header-anchor" href="#关于资源文件"><span>关于资源文件</span></a></h3><p>Qt 提供方便的资源文件引用。在项目中通过 <code>Add New...</code>新建 Qt Resource File<sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup> 并添加文件到 <code>.qrc</code> 内。Qt 在构建时会将添加的文件以二进制形式存放在生成的 exe 文件中。无需将资源文件放入打包目录，程序将会从 exe 中引用资源。</p><p>但是请注意，<strong>加入 .qrc 中的资源文件是只读的。有修改需求的文件请勿使用此方法。*</strong>（使用相对路径）*</p><h3 id="添加图标与版本信息" tabindex="-1"><a class="header-anchor" href="#添加图标与版本信息"><span>添加图标与版本信息</span></a></h3><details class="hint-container details"><summary>使用 qmake，已过时</summary><p>图标：在项目目录下放入 .ico 图标（<a href="https://www.aconvert.com/cn/icon/" target="_blank" rel="noopener noreferrer">在线转 ico</a>），在项目 .pro 文件中加入 <code>RC_ICONS = xxx.ico</code> 即可。所有该项目下的子窗口都会自动使用该图标。注意仅允许 ico 格式图像。</p><p>版本信息：在项目 .pro 文件中加入 <code>VERSION = x.x.x</code> 即可。</p></details><ol><li>新建 <code>xxx.rc</code>，内容为 <code>IDI_ICON1 ICON DISCARDABLE &quot;logo.ico&quot;</code> （定位到你的 ico 图标）</li><li>（使用 <a href="#xmake">xmake</a>）将 <code>xxx.rc</code> 加入 xmake.lua：<code>add_files(static/xxx.rc)</code></li></ol><h3 id="打包" tabindex="-1"><a class="header-anchor" href="#打包"><span>打包</span></a></h3><p>Qt 拥有人性化的打包服务。复制 release 输出目录中的 exe 文件到任意目标目录，在目录下使用 <code>windeployqt xxx.exe</code> 命令即可完成打包（windeployqt 需要在环境变量内，否则使用绝对位置）。</p><p>但是到了 Qt6，情况就完全不一样了。。Qt6 的打包不管使用 <code>windeployqt</code> 或 <code>windeployqt6</code> 打包后，程序都无法运行。重装 SDK 后也是如此。首先，使用 <code>windeployqt</code> 会缺失 <code>Qt6Core.dll</code>, <code>Qt6Gui.dll</code>, <code>Qt6Widgets.dll</code> 这老三样。其次，手动复制这三样后，测试还会出现 bug：</p><figure style="max-width:calc(0.5 * var(--content-width));" data-v-b469dc56><img alt="bug" src="/images/coding/cpp/windeployqt_bug.png" loading="lazy" style="max-width:calc(0.5 * var(--content-width));" data-v-b469dc56><figcaption data-v-b469dc56>bug</figcaption></figure><p>解法是将 Qt SDK 目录下的 <code>plugins</code> 文件夹复制到打包的 exe 目录下<sup class="footnote-ref"><a href="#footnote3">[3]</a><a class="footnote-anchor" id="footnote-ref3"></a></sup>。。</p><h4 id="优化" tabindex="-1"><a class="header-anchor" href="#优化"><span>优化</span></a></h4><p>这样打包出来的程序体积还能<strong>进一步缩小</strong>。运行 exe 后，全选目录下文件并删除，跳过已被打开的所有文件，并递归地对每个文件夹进行同样的操作。这样能够移除不必要的运行库从而<mark>大幅</mark>降低发布包的大小。</p><h4 id="测试" tabindex="-1"><a class="header-anchor" href="#测试"><span>测试</span></a></h4><p>打包之后需要测试有没有丢运行库。换用另一个环境测试也太麻烦了点，而傻逼 windows GUI 也把环境变量藏得实在是太好，徒增了许多麻烦。其实只要在命令行中临时删除环境变量，再运行即可：</p><!----><h3 id="全局快捷键" tabindex="-1"><a class="header-anchor" href="#全局快捷键"><span>全局快捷键</span></a></h3><p><a href="https://blog.csdn.net/scueee/article/details/108541574" target="_blank" rel="noopener noreferrer">参考此文章</a>。<em>如果要在 Qt6 中使用，需要把 <code>virtual bool nativeEventFilter</code> 的最后一个参数由 <code>long*</code> 改为 <code>qintptr*</code>.</em></p><blockquote><p>怎么说，这几乎是我在几乎全网搜到的唯一可用的全局快捷键代码<sup class="footnote-ref"><a href="#footnote4">[4]</a><a class="footnote-anchor" id="footnote-ref4"></a></sup>。。而且由于调用了 windows api，因此只能在目标为 windows 上的 Qt 使用。linux 还需要看看 Github <a href="https://github.com/Skycoder42/QHotkey" target="_blank" rel="noopener noreferrer">QHotKey</a>。</p></blockquote><h3 id="按键事件" tabindex="-1"><a class="header-anchor" href="#按键事件"><span>按键事件</span></a></h3><p>Qt6 提供了 <em>QShortCut</em>，大大简化了<mark>非全局</mark>按键事件的处理。只需要创建一个 <em>QShortCut</em> 对象，connect 即可。</p><h3 id="json-处理" tabindex="-1"><a class="header-anchor" href="#json-处理"><span>JSON 处理</span></a></h3><blockquote><p>根据 <a href="#%E6%BD%9C%E4%BC%8F%E7%9F%A5%E8%AF%86">benchmark</a>，QJson 是 JSON 库中占用内存最小的。（某个测试项目）</p></blockquote><h4 id="读取" tabindex="-1"><a class="header-anchor" href="#读取"><span>读取</span></a></h4><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">QFile</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;a.json&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(QIODevice::ReadOnly)){</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    qDebug</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;open file failed.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">QByteArray</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">readAll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">QJsonParseError jError;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">QJsonDocument jDoc </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> QJsonDocument::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fromJson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(data, </span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">jError);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">jError</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> !=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> QJsonParseError::NoError){</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    qDebug</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;read json error.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">QJsonObject rootjsonobj </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> jDoc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时<code>rootjsonobj</code>即为读入的 QJsonObject 对象（理解为 python 中的字典对象）。</p><p>通过 <code>rootjsonobj[KEY]</code> 访问得到一个 QJsonValue，可以调用 <code>toObject()</code> / <code>toString()</code> 等函数将之转换为对应类型。</p><h4 id="写入" tabindex="-1"><a class="header-anchor" href="#写入"><span>写入</span></a></h4><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">QJsonDocument</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> jDoc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">rootjsonobj</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">QFile</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;b.json&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(QIODevice::Truncate </span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">|</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> QIODevice::WriteOnly)){</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    qDebug</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;write json error.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">QByteArray</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">jDoc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toJson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(data);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="潜伏知识" tabindex="-1"><a class="header-anchor" href="#潜伏知识"><span>潜伏知识</span></a></h2><ol><li>C++ 开源 json 库性能好的有 simdjson 和 sonic；<a href="https://github.com/miloyip/nativejson-benchmark" target="_blank" rel="noopener noreferrer">benchmark</a>, but out of date</li></ol><h2 id="external" tabindex="-1"><a class="header-anchor" href="#external"><span>external</span></a></h2><ol><li><a href="https://github.com/wuye9036/CppTemplateTutorial" target="_blank" rel="noopener noreferrer">C++ Template 进阶指南</a></li><li><a href="https://www.bilibili.com/video/BV1et4y1D796/" target="_blank" rel="noopener noreferrer">2020 年 C++语言律师 等级考试 参考答案</a></li><li><a href="https://www.zhihu.com/question/22853451/answer/1847571322" target="_blank" rel="noopener noreferrer">为什么看到这么多人不推荐 C++？</a></li><li><a href="https://kristoff.it/blog/zig-new-relationship-llvm/" target="_blank" rel="noopener noreferrer">Zig&#39;s New Relationship with LLVM</a></li><li><a href="https://xr1s.me/2023/08/13/cxx-user-defined-range-adaptor/" target="_blank" rel="noopener noreferrer">C++ 用户定义 Ranges 算子</a></li><li>C++23 特性总结 <a href="https://zhuanlan.zhihu.com/p/562383157" target="_blank" rel="noopener noreferrer">上</a> | <a href="https://zhuanlan.zhihu.com/p/562383556" target="_blank" rel="noopener noreferrer">下</a>，可以学到很多</li><li><a href="https://zhuanlan.zhihu.com/p/642214693" target="_blank" rel="noopener noreferrer">C++ 移动语义</a></li><li><a href="https://zhuanlan.zhihu.com/p/25148592" target="_blank" rel="noopener noreferrer">[Brief Talk] <code>auto</code>, <code>auto&amp;</code>, <code>const auto&amp;</code> 以及其它形式的 auto 变种在 for-range loop 的选择</a></li><li><a href="https://zhuanlan.zhihu.com/p/391088391" target="_blank" rel="noopener noreferrer">浅谈 C++ Undefined Behavior</a></li><li><a href="https://zhuanlan.zhihu.com/p/380982475" target="_blank" rel="noopener noreferrer">ELF 格式的 Symbol 及 C++ 的 inline 关键字</a></li><li><a href="https://simontoth.substack.com/archive" target="_blank" rel="noopener noreferrer">Daily bit(e) of C++</a></li><li><a href="https://tulach.cc/writing-gui-apps-for-windows-is-painful/" target="_blank" rel="noopener noreferrer">Writing GUI apps for Windows is painful</a></li><li><a href="https://hackingcpp.com/" target="_blank" rel="noopener noreferrer">hackingcpp</a>：提供语法的简洁 cheatsheet。</li><li><a href="https://ykiko.me/zh-cn/articles/645810896/" target="_blank" rel="noopener noreferrer">std::variant 很难用！</a></li><li><a href="https://github.com/Qihoo360/safe-rules/blob/main/cpp-ub-list.md" target="_blank" rel="noopener noreferrer">附录：C++ 未定义行为成因列表</a></li></ol><p>books:</p><ol><li><a href="https://github.com/weaiken/ebook/blob/master/01_programming/C++/C++%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97.pdf" target="_blank" rel="noopener noreferrer">C++ 性能优化指南</a></li><li><a href="https://best.openssf.org/Compiler-Hardening-Guides/Compiler-Options-Hardening-Guide-for-C-and-C++.html" target="_blank" rel="noopener noreferrer">Compiler Options Hardening Guide for C and C++</a></li></ol><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p>例如我在嵌入式课用 vscode 写码，我需要一个 formatter 减少我的精神负担，但是由于嵌入式开发 Keil 使用自己的构建系统，因此我希望关闭 linter，否则 linter 读不出项目的结构，会满屏红色报错。 <a href="#footnote-ref1" class="footnote-backref">↩︎</a></p></li><li id="footnote2" class="footnote-item"><p><code>.qrc</code> 文件内部是 xml 格式，理论可手搓，因此可以放心抛弃 QtCreator。 <a href="#footnote-ref2" class="footnote-backref">↩︎</a></p></li><li id="footnote3" class="footnote-item"><p>我找出这个问题<a class="route-link" href="/gossip/difficulties.html#20230507qt6-%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E5%A4%B1%E8%B4%A5">真的不容易</a>，还差点错怪 xmake。。主要是 <code>Plugins</code> 并不在我的环境变量中，但却能够跑起来，迷惑了我的判断。这个报错也基本上得不到信息，网上也找不到解法。 <a href="#footnote-ref3" class="footnote-backref">↩︎</a></p></li><li id="footnote4" class="footnote-item"><p>升级 Qt6 后我尝试寻找其他全局快捷键方法，全部失败。甚至生出了直接调 windows.h api 的心。 <a href="#footnote-ref4" class="footnote-backref">↩︎</a></p></li></ol></section></div><!----><!----><!----></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">最近更新：</span><time class="vp-meta-info" datetime="2025-05-26T16:52:58.000Z" data-allow-mismatch>2025/5/26 16:52</time></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/coding/python.html" aria-label="Python" iconsizing="both"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><i class="vp-icon fas fa-brands fa-python" sizing="height"></i>Python</div></a><a class="route-link auto-link next" href="/coding/shell.html" aria-label="shell script" iconsizing="both"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">shell script<i class="vp-icon fas fa-fish" sizing="height"></i></div></a></nav><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div style="display: flex;
align-items: center;
justify-content: center;
height: 96px"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);
--icon-size: 48px;
display: inline-block;
width: var(--icon-size);
height: var(--icon-size);
background-color: currentcolor;
-webkit-mask-image: var(--loading-icon);
mask-image: var(--loading-icon);
"></span></div></div><!----><!--]--></main><!--]--><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-B0ingTY3.js" defer></script>
  </body>
</html>
